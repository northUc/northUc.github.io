(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{210:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"cicd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cicd","aria-hidden":"true"}},[t._v("#")]),t._v(" cicd")]),t._v(" "),s("h2",{attrs:{id:"安装git"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装git","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装git")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("yum install git "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("y\n")])])]),s("h2",{attrs:{id:"安装-jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-jenkins","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装 Jenkins")]),t._v(" "),s("h3",{attrs:{id:"安装java"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装java","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装java")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("yum install "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("y java\n")])])]),s("h3",{attrs:{id:"安装jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装jenkins","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装jenkins")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("sudo wget "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("O /etc/yum.repos.d/jenkins.repo https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//img.zhufengpeixun.com/jenkins.repo\nsudo rpm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("import https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//img.zhufengpeixun.com/jenkins.io.key\nyum install jenkins "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("y\n")])])]),s("h3",{attrs:{id:"启动-jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动-jenkins","aria-hidden":"true"}},[t._v("#")]),t._v(" 启动 Jenkins")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("systemctl start jenkins.service\n")])])]),s("ul",[s("li",[t._v("开放端口")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("firewall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cmd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("zone=public "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("add"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port=8080/tcp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("permanent\nfirewall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cmd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("zone=public "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("add"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port=50000/tcp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("permanent\nsystemctl reload firewalld\n")])])]),s("ul",[s("li",[t._v("打开浏览器访问")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8080/\n")])])]),s("ul",[s("li",[t._v("查看密码")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("cat /var/lib/jenkins/secrets/initialAdminPassword\n")])])]),s("ul",[s("li",[t._v("修改插件镜像")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("sed "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("i 's/http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\/\\/updates.jenkins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ci.org\\/download/https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g' /var/lib/jenkins/updates/default.json && sed "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("i 's/http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\/\\/www.google.com/https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\/\\/www.baidu.com/g' /var/lib/jenkins/updates/default.json\n")])])]),s("ul",[s("li",[t._v("添加到docker用户组里")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("sudo gpasswd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("a jenkins docker  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将当前用户添加至docker用户组")]),t._v("\nnewgrp docker                 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更新docker用户组")]),t._v("\n\nsudo service jenkins restart "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启")]),t._v("\n")])])]),s("h3",{attrs:{id:"新建任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建任务","aria-hidden":"true"}},[t._v("#")]),t._v(" 新建任务")]),t._v(" "),s("ul",[s("li",[t._v("新建任务=>构建一个自由风格的软件项目=>配置>增加构建步骤")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("docker "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v\ndocker pull node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n")])])]),s("ul",[s("li",[t._v("再次执行脚本。此时执行成功")])]),t._v(" "),s("h2",{attrs:{id:"安装nodejs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装nodejs","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装Nodejs")]),t._v(" "),s("ul",[s("li",[t._v("系统管理 => 插件管理 => 可选插件 =》 安装NodeJS插件")]),t._v(" "),s("li",[t._v("系统管理 => 全局工具配置 => NodeJS => 新增NodeJS")]),t._v(" "),s("li",[t._v("任务的配置=>构建环境=>选中 Provide Node & npm bin/ folder to PATH")])]),t._v(" "),s("h2",{attrs:{id:"jenkins-测试第一个dome"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-测试第一个dome","aria-hidden":"true"}},[t._v("#")]),t._v(" Jenkins 测试第一个dome")]),t._v(" "),s("h3",{attrs:{id:"git-仓库-保存一份代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#git-仓库-保存一份代码","aria-hidden":"true"}},[t._v("#")]),t._v(" git 仓库 保存一份代码")]),t._v(" "),s("ul",[s("li",[t._v("/build/index.html")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("<"),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!DOCTYPE")]),t._v(" html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v('\n<html lang="en"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n<head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v('\n    <meta charset="UTF'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('8"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    <meta http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('equiv="X'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("UA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('Compatible" content="IE=edge"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v('\n    <meta name="viewport" content="width=device'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("width"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" initial"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('scale=1.0"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    <title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("Document</title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n</head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n<body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    1111\n</body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n</html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n")])])]),s("ul",[s("li",[t._v("conf/nginx.conf")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tworker_connections 1024;\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       80;\n        listen       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("80;\n        server_name  _;\n        root         /etc/nginx/html;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("Dockerfile")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("FROM nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.15")]),t._v("\nCOPY build /etc/nginx/html\nCOPY conf /etc/nginx/\nWORKDIR /etc/nginx/html\n")])])]),s("h3",{attrs:{id:"jenkins-配置私钥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-配置私钥","aria-hidden":"true"}},[t._v("#")]),t._v(" Jenkins 配置私钥")]),t._v(" "),s("ul",[s("li",[t._v("我们可以在配置任务时，来添加一个自己的凭证。点击项目的 配置，依次找到 源码管理 => Git => Repositories\n"),s("ul",[s("li",[t._v("Repository URL, 地址格式为 "),s("code",[t._v("git@gitee.com:xxx/xxx.git")]),t._v(",(可以将上面的保存代码的地址复制过来)")])])]),t._v(" "),s("li",[t._v("重点是 Credentials 这一项，这里则是我们选择认证凭证的地方。我们可以点击右侧 添加 => Jenkins 按钮添加一条新的凭证认证信息。")]),t._v(" "),s("li",[t._v("点击后会打开一个弹窗，这是 Jenkins 添加凭证的弹窗。选择类型中的 SSH Username with private key 这一项。接着填写信息即可：\n"),s("ul",[s("li",[t._v("D：这条认证凭证在 Jenkins 中的名称是什么")]),t._v(" "),s("li",[t._v("描述：描述信息")]),t._v(" "),s("li",[t._v("Username：用户名（邮箱）")]),t._v(" "),s("li",[t._v("Private Key：这里则是我们填写私钥的地方。点击 Add 按钮，将 xxx 私钥文件内所有文件内容全部复制过去（包含开头的 BEGIN OPENSSH PRIVATE KEY 和结尾的 END OPENSSH PRIVATE KEY）")]),t._v(" "),s("li",[t._v("私钥 ~/.ssh/id_rsa`")]),t._v(" "),s("li",[t._v("如果没有出现红色无权限提示，则代表身份校验成功，可以正常访问。")])])])]),t._v(" "),s("h3",{attrs:{id:"构建镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像","aria-hidden":"true"}},[t._v("#")]),t._v(" 构建镜像")]),t._v(" "),s("ul",[s("li",[t._v("构建 => Execute shell。输入以下脚本：")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/sh -l")]),t._v("\ndocker build "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("t test .\ndocker run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p 8888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("80 test\n")])])]),s("ul",[s("li",[t._v("在如果构建成功 在服务里可以看到这个镜像,同时\b容器运行成功")])]),t._v(" "),s("h2",{attrs:{id:"镜像库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#镜像库","aria-hidden":"true"}},[t._v("#")]),t._v(" 镜像库")]),t._v(" "),s("ul",[s("li",[t._v("部署 Nexus 服务")]),t._v(" "),s("li",[t._v("在部署 Nexus 之前，需要先下载 Nexus 的安装包（这里需要另外找个托管服务）")]),t._v(" "),s("li",[t._v("解压后，我们可以看到有2个文件夹。分别是 nexus-3.29.0-02 和 sonatype-work 。其中，nexus-3.29.0-02 是nexus主程序文件夹，sonatype-work 则是数据文件。")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("wget https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//dependency"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("fe.oss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("beijing.aliyuncs.com/nexus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3.29.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("unix.tar.gz\n\ntar "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("zxvf ./nexus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3.29.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("unix.tar.gz\n")])])]),s("h2",{attrs:{id:"启动-nexus"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动-nexus","aria-hidden":"true"}},[t._v("#")]),t._v(" 启动 Nexus")]),t._v(" "),s("ul",[s("li",[t._v("我们进入 nexus-3.29.0-02 下面的 bin 目录，这里就是 nexus 的主命令目录。我们在 bin 目录下，执行 ./nexus start 命令即可启动 nexus ：")]),t._v(" "),s("li",[t._v("nexus 还支持停止，重启等命令。可以在 bin 目录下执行 ./nexus help 查看更多命令")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("./nexus start\n")])])]),s("ul",[s("li",[t._v("由于 nexus 默认服务端口是 8081，稍后我们还需要给镜像库访问单独开放一个 8082 端口。这里将 8081，8082 端口添加到防火墙放行规则内（没开防火墙则可以略过）：")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("firewall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cmd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("zone=public "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("add"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port=8081/tcp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("permanent\nfirewall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cmd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("zone=public "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("add"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port=8082/tcp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("permanent\n")])])]),s("ul",[s("li",[t._v("打开浏览器地址栏，访问 IP:8081 。启动时间比较长，需要耐心等待。在 Nexus 启动后，会进入这个欢迎页面：")])]),t._v(" "),s("h2",{attrs:{id:"配置-nexus"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-nexus","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置 Nexus")]),t._v(" "),s("ul",[s("li",[t._v("进入欢迎页后，点击右上角的登录，会打开登录框。这里需要我们输入 默认管理员密码 进行初始化配置。")]),t._v(" "),s("li",[t._v("可以在这里找到：")]),t._v(" "),s("li",[t._v("将文件中获取到的密码输入进去，登录用户名是 admin 。")]),t._v(" "),s("li",[t._v("注意请立即更改密码")]),t._v(" "),s("li",[t._v("Enable anonymous access")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注意  /root/这个是安装的目录  根据自己的情况")]),t._v("\ncat /root/sonatype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("work/nexus3/admin.password \n")])])]),s("h3",{attrs:{id:"创建docker私服"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建docker私服","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建Docker私服")]),t._v(" "),s("ul",[s("li",[t._v("登录 => 齿轮图标 => Repositories => Create repository => docker(hosted) => HTTP(8082)")]),t._v(" "),s("li",[t._v("proxy: 此类型制品库原则上只下载，不允许用户推送")]),t._v(" "),s("li",[t._v("hosted：此类型制品库和 proxy 相反，原则上 只允许用户推送，不允许缓存。这里只存放自己的私有镜像或制品")]),t._v(" "),s("li",[t._v("group：此类型制品库可以将以上两种类型的制品库组合起来")])]),t._v(" "),s("h3",{attrs:{id:"添加访问权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加访问权限","aria-hidden":"true"}},[t._v("#")]),t._v(" 添加访问权限")]),t._v(" "),s("ul",[s("li",[t._v("齿轮图标 => Realms => Docker Bearer Token Realm => 添加到右边的 Active =>保存")]),t._v(" "),s("li",[t._v("copy http://106.15.106.83:8081/repository/study/")])]),t._v(" "),s("h3",{attrs:{id:"登录制品库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#登录制品库","aria-hidden":"true"}},[t._v("#")]),t._v(" 登录制品库")]),t._v(" "),s("ul",[s("li",[t._v("如果有这个报错 需要配置下面内容")]),t._v(" "),s("li",[s("code",[t._v('Failed to pull image "106.15.106.83:8082/frontend-app:20210927153747": rpc error: code = Unknown desc = Error response from daemon: Get "https://106.15.106.83:8082/v2/": http: server gave HTTP response to HTTPS client')])]),t._v(" "),s("li",[t._v("vi /etc/docker/daemon.json")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"insecure-registries"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"106.15.106.83:8082"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"registry-mirrors"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://fwvjnv59.mirror.aliyuncs.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n\n106.15.106.83"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8082/test\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# master")]),t._v("\n47.100.74.198"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("49154")]),t._v("\n\n\nprivate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry\n\nregcred\n\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重载所有修改过的配置文件")]),t._v("\nsudo systemctl daemon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reload\nsudo systemctl restart docker\n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("systemctl restart docker\ndocker login 106.15.106.83"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8082 //注意此处要和insecure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registries里的地址一致\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n")])])]),s("ul",[s("li",[t._v("如果这个报错 "),s("code",[t._v("no basic auth credentials")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置私有的 建议这个")]),t._v("\nkubectl create secret docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry private"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry \\\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("username=admin \\\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password=Sg920322 \\\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("email=501798525@qq.com \\\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=106.15.106.83"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8082")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者直接拿取docker配置")]),t._v("\nkubectl create secret generic regcred  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file=.dockerconfigjson=/root/.docker/config.json "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("type=kubernetes.io/dockerconfigjson\n")])])]),s("h2",{attrs:{id:"利用-jenkins推送镜像到制品库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#利用-jenkins推送镜像到制品库","aria-hidden":"true"}},[t._v("#")]),t._v(" 利用 Jenkins推送镜像到制品库")]),t._v(" "),s("h3",{attrs:{id:"利用凭据给-shell-注入镜像库用户名密码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#利用凭据给-shell-注入镜像库用户名密码","aria-hidden":"true"}},[t._v("#")]),t._v(" 利用凭据给 Shell 注入镜像库用户名密码")]),t._v(" "),s("ul",[s("li",[t._v("设置界面 => 构建环境 => 勾选 Use secret text(s) or file(s) => 新增选择 => Username and password (separated)\n"),s("ul",[s("li",[t._v("DOCKER_LOGIN_USERNAME")]),t._v(" "),s("li",[t._v("DOCKER_LOGIN_PASSWORD")])])]),t._v(" "),s("li",[t._v("接着在下面指定凭据=>添加jenkins=>选择类型Username with password,输入用户名和密码然后点添加确定,这里的账号"),s("code",[t._v("admin")]),t._v("对应"),s("code",[t._v("DOCKER_LOGIN_USERNAME")]),t._v(", "),s("code",[t._v("DOCKER_LOGIN_PASSWORD")]),t._v("对应输入密码"),s("code",[t._v("123456")])]),t._v(" "),s("li",[t._v("修改 \b\b\bshell 执行")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/sh -l")]),t._v("\ndocker build "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("t 106.15.106.83"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8082/test .\ndocker login "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("u $DOCKER_LOGIN_USERNAME "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p $DOCKER_LOGIN_PASSWORD 106.15.106.83"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8082")]),t._v("\ndocker push 106.15.106.83"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8082/test\n")])])])])}],!1,null,null,null);a.default=e.exports}}]);