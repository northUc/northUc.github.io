(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{215:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("p"),t._m(0),a("p"),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._m(25),t._v(" "),t._m(26),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._m(30),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._m(38),t._v(" "),t._m(39),t._m(40),t._v(" "),t._m(41),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),t._m(45),t._v(" "),t._m(46),t._m(47),t._v(" "),t._m(48),t._m(49),t._v(" "),t._m(50),t._m(51),t._v(" "),a("ul",[t._m(52),t._v(" "),a("li",[t._v("Node是计算节点\n"),a("ul",[a("li",[t._v("CRI(Container Runtime Interface)的远程调用接口，这个接口定义了容器运行时的各项核心操作")]),t._v(" "),a("li",[t._v("OCI(Open Container Initiative) 容器运行时通过OCI同底层的Linux操作系统进行交互")]),t._v(" "),a("li",[t._v("设备插件是用来管理宿主机物理设备的组件")]),t._v(" "),a("li",[t._v("gRPC是可以在任何环境中运行的现代开源高性能 RPC 框架")]),t._v(" "),a("li",[t._v("RPC是指远程过程调用，也就是说两台服务器A，B，一个应用部署在A服务器上，想要调用B服务器上应用提供的函数/方法，由于不在一个内存空间，不能直接调用，需要通过网络来表达调用的语义和传达调用的数据\n"),a("img",{attrs:{src:t.$withBase("/img/kubernetes_produce.jpg")}}),t._v(" "),a("img",{attrs:{src:t.$withBase("/img/kubernetes_ingress.jpg")}})])])])]),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._m(56),t._v(" "),t._m(57),t._m(58),t._v(" "),t._m(59),t._v(" "),t._m(60),t._m(61),t._v(" "),t._m(62),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65),t._v(" "),t._m(66),t._v(" "),t._m(67),t._v(" "),t._m(68),t._v(" "),t._m(69),t._m(70),t._v(" "),t._m(71),t._v(" "),t._m(72),t._m(73),t._v(" "),t._m(74),t._v(" "),t._m(75),t._v(" "),t._m(76),t._v(" "),t._m(77),t._m(78),t._v(" "),t._m(79),t._v(" "),t._m(80),t._v(" "),t._m(81),t._m(82),t._v(" "),t._m(83),t._m(84),t._v(" "),t._m(85),t._v(" "),t._m(86),t._m(87),t._v(" "),t._m(88),t._v(" "),t._m(89),t._m(90),t._v(" "),t._m(91),t._v(" "),t._m(92),t._v(" "),t._m(93),t._v(" "),t._m(94),t._m(95),t._v(" "),t._m(96),t._v(" "),t._m(97),t._m(98),t._v(" "),t._m(99),t._v(" "),t._m(100),t._v(" "),t._m(101),t._m(102),t._v(" "),t._m(103),t._v(" "),t._m(104),t._v(" "),t._m(105),t._v(" "),t._m(106),t._v(" "),t._m(107),t._v(" "),t._m(108),t._v(" "),t._m(109),t._v(" "),t._m(110),t._v(" "),t._m(111),t._v(" "),t._m(112),t._m(113),t._v(" "),t._m(114),t._v(" "),t._m(115),t._m(116),t._v(" "),t._m(117),t._v(" "),t._m(118),t._v(" "),t._m(119),t._m(120),t._v(" "),t._m(121),t._v(" "),t._m(122),t._v(" "),t._m(123),t._v(" "),t._m(124),t._v(" "),t._m(125),t._v(" "),t._m(126),t._m(127),t._v(" "),t._m(128),t._m(129),t._v(" "),t._m(130),t._m(131),t._v(" "),t._m(132),t._v(" "),t._m(133),t._m(134),t._v(" "),t._m(135),t._m(136),t._v(" "),t._m(137),t._m(138),t._v(" "),t._m(139),t._m(140),t._v(" "),t._m(141),t._v(" "),t._m(142),t._v(" "),t._m(143),t._v(" "),t._m(144),t._m(145),t._v(" "),t._m(146),t._m(147),t._v(" "),t._m(148),t._m(149),t._v(" "),t._m(150),t._v(" "),t._m(151),t._v(" "),t._m(152),t._m(153),t._v(" "),t._m(154),t._v(" "),t._m(155),t._m(156),t._v(" "),t._m(157),t._m(158),t._v(" "),t._m(159),t._v(" "),t._m(160),t._v(" "),t._m(161),t._v(" "),t._m(162),t._v(" "),t._m(163),t._v(" "),t._m(164),t._m(165),t._v(" "),t._m(166),t._m(167),t._v(" "),t._m(168),t._v(" "),t._m(169),t._m(170),t._v(" "),t._m(171),t._v(" "),t._m(172),t._m(173),t._v(" "),t._m(174),t._m(175),t._m(176),t._v(" "),t._m(177),t._v(" "),t._m(178),t._m(179),t._v(" "),t._m(180),t._m(181),t._v(" "),t._m(182),t._m(183),t._v(" "),t._m(184),t._v(" "),t._m(185),t._v(" "),t._m(186),t._m(187),t._m(188),t._v(" "),t._m(189),t._v(" "),t._m(190),t._m(191),t._v(" "),t._m(192),t._m(193),t._v(" "),t._m(194),t._v(" "),t._m(195),t._v(" "),t._m(196),t._v(" "),t._m(197),t._v(" "),t._m(198),t._m(199),t._v(" "),t._m(200),t._v(" "),t._m(201),t._m(202),t._v(" "),t._m(203),t._m(204),t._v(" "),t._m(205),t._v(" "),t._m(206),t._v(" "),t._m(207),t._v(" "),t._m(208),t._m(209),t._v(" "),t._m(210),t._v(" "),t._m(211),t._m(212),t._v(" "),t._m(213),t._v(" "),t._m(214),t._m(215),t._v(" "),t._m(216),t._m(217),t._v(" "),a("p",[t._v("106.15.106.83:8082:test:20210927171653")])])},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#基础安装"}},[t._v("基础安装")]),a("ul",[a("li",[a("a",{attrs:{href:"#kubernetes组件"}},[t._v("Kubernetes组件")])]),a("li",[a("a",{attrs:{href:"#设置bridge-nf-call-iptables"}},[t._v("设置bridge-nf-call-iptables")])])])]),a("li",[a("a",{attrs:{href:"#master节点配置"}},[t._v("Master节点配置")]),a("ul",[a("li",[a("a",{attrs:{href:"#配置-kubernetes-初始化文件"}},[t._v("配置 Kubernetes 初始化文件")])]),a("li",[a("a",{attrs:{href:"#拉取其它组件"}},[t._v("拉取其它组件")])]),a("li",[a("a",{attrs:{href:"#初始化-kubernetes"}},[t._v("初始化 Kubernetes")])])])]),a("li",[a("a",{attrs:{href:"#如果上面的配置-终断了-删除文件-在重新init-安装kubernetes"}},[t._v("如果上面的配置 终断了  删除文件 在重新init 安装Kubernetes")]),a("ul",[a("li",[a("a",{attrs:{href:"#安装-flannel"}},[t._v("安装 Flannel")])]),a("li",[a("a",{attrs:{href:"#查看master-启动情况"}},[t._v("查看master 启动情况")])]),a("li",[a("a",{attrs:{href:"#node节点配置"}},[t._v("Node节点配置")])]),a("li",[a("a",{attrs:{href:"#加入-master-节点"}},[t._v("加入 Master 节点")])]),a("li",[a("a",{attrs:{href:"#安装-flannel"}},[t._v("安装 Flannel")])]),a("li",[a("a",{attrs:{href:"#查看状态"}},[t._v("查看状态")])])])]),a("li",[a("a",{attrs:{href:"#kubernetes介绍"}},[t._v("Kubernetes介绍")])]),a("li",[a("a",{attrs:{href:"#制作简单的镜像"}},[t._v("制作简单的镜像")]),a("ul",[a("li",[a("a",{attrs:{href:"#docker-build-index-html"}},[t._v("docker/build/index.html")])]),a("li",[a("a",{attrs:{href:"#docker-conf-nginx-conf"}},[t._v("docker/conf/nginx.conf")])]),a("li",[a("a",{attrs:{href:"#docker-dockerfile"}},[t._v("docker/Dockerfile")])]),a("li",[a("a",{attrs:{href:"#发布"}},[t._v("发布")])])])]),a("li",[a("a",{attrs:{href:"#pod"}},[t._v("Pod")]),a("ul",[a("li",[a("a",{attrs:{href:"#deployment"}},[t._v("deployment")])]),a("li",[a("a",{attrs:{href:"#创建-deployment"}},[t._v("创建 deployment")])]),a("li",[a("a",{attrs:{href:"#部署-deployment"}},[t._v("部署 deployment")])])])]),a("li",[a("a",{attrs:{href:"#service"}},[t._v("Service")]),a("ul",[a("li",[a("a",{attrs:{href:"#创建服务"}},[t._v("创建服务")])]),a("li",[a("a",{attrs:{href:"#查看服务"}},[t._v("查看服务")])])])]),a("li",[a("a",{attrs:{href:"#编写-ingress配置文件"}},[t._v("编写 ingress配置文件")])]),a("li",[a("a",{attrs:{href:"#查看-ingress-nginx和普通pod-操作"}},[t._v("查看 ingress-nginx和普通pod 操作")])]),a("li",[a("a",{attrs:{href:"#灰度发布"}},[t._v("灰度发布")]),a("ul",[a("li",[a("a",{attrs:{href:"#根据-cookie-切分流量"}},[t._v("根据 Cookie 切分流量")])]),a("li",[a("a",{attrs:{href:"#准备新版本service"}},[t._v("准备新版本Service")])]),a("li",[a("a",{attrs:{href:"#配置-ingress-gray"}},[t._v("配置 ingress-gray")])]),a("li",[a("a",{attrs:{href:"#基于-header-切分流量"}},[t._v("基于 Header 切分流量")])]),a("li",[a("a",{attrs:{href:"#基于权重切分流量"}},[t._v("基于权重切分流量")])]),a("li",[a("a",{attrs:{href:"#优先级"}},[t._v("优先级")])])])]),a("li",[a("a",{attrs:{href:"#滚动发布"}},[t._v("滚动发布")]),a("ul",[a("li",[a("a",{attrs:{href:"#发布流程和策略"}},[t._v("发布流程和策略")])]),a("li",[a("a",{attrs:{href:"#先扩容为10个副本"}},[t._v("先扩容为10个副本")])]),a("li",[a("a",{attrs:{href:"#配置文件"}},[t._v("配置文件")])]),a("li",[a("a",{attrs:{href:"#另一种发布模式"}},[t._v("另一种发布模式")])])])]),a("li",[a("a",{attrs:{href:"#kubectl-rollout"}},[t._v("kubectl rollout")])]),a("li",[a("a",{attrs:{href:"#kubernetes-secret：储存你的机密信息"}},[t._v("Kubernetes Secret：储存你的机密信息")]),a("ul",[a("li",[a("a",{attrs:{href:"#secret-的几种类型"}},[t._v("Secret 的几种类型")])]),a("li",[a("a",{attrs:{href:"#opaque-类型"}},[t._v("Opaque 类型")])]),a("li",[a("a",{attrs:{href:"#私有镜像库认证"}},[t._v("私有镜像库认证")])])])]),a("li",[a("a",{attrs:{href:"#密钥的使用方法"}},[t._v("密钥的使用方法")]),a("ul",[a("li",[a("a",{attrs:{href:"#volume-挂载"}},[t._v("Volume 挂载")])]),a("li",[a("a",{attrs:{href:"#环境变量注入"}},[t._v("环境变量注入")])]),a("li",[a("a",{attrs:{href:"#docker-私有库认证"}},[t._v("Docker 私有库认证")])])])]),a("li",[a("a",{attrs:{href:"#configmap"}},[t._v("ConfigMap")]),a("ul",[a("li",[a("a",{attrs:{href:"#什么是-configmap"}},[t._v("什么是 ConfigMap")])]),a("li",[a("a",{attrs:{href:"#_1、创建"}},[t._v("1、创建")])]),a("li",[a("a",{attrs:{href:"#_2、配置清单创建"}},[t._v("2、配置清单创建")])]),a("li",[a("a",{attrs:{href:"#_3、文件创建"}},[t._v("3、文件创建")])]),a("li",[a("a",{attrs:{href:"#目录创建"}},[t._v("目录创建")])]),a("li",[a("a",{attrs:{href:"#使用"}},[t._v("使用")])]),a("li",[a("a",{attrs:{href:"#环境变量注入"}},[t._v("环境变量注入")])]),a("li",[a("a",{attrs:{href:"#存储卷挂载"}},[t._v("存储卷挂载")])])])]),a("li",[a("a",{attrs:{href:"#服务发现"}},[t._v("服务发现")]),a("ul",[a("li",[a("a",{attrs:{href:"#coredns"}},[t._v("CoreDNS")])]),a("li",[a("a",{attrs:{href:"#服务发现规则"}},[t._v("服务发现规则")])])])]),a("li",[a("a",{attrs:{href:"#污点与容忍"}},[t._v("污点与容忍")]),a("ul",[a("li",[a("a",{attrs:{href:"#给-node-设置污点"}},[t._v("给 Node 设置污点")])]),a("li",[a("a",{attrs:{href:"#给-pod-设置容忍度"}},[t._v("给 Pod 设置容忍度")])]),a("li",[a("a",{attrs:{href:"#修改-删除-node-的污点"}},[t._v("修改/删除 Node 的污点")])])])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"kubernetes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes","aria-hidden":"true"}},[this._v("#")]),this._v(" Kubernetes")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("Kubernetes 看作是用来是一个部署镜像的平台")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// master")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("47.100")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".74")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".198")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("31234")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.28")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".240")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".100")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// node 1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("47.102")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".114")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".8")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.28")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".240")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".102")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// node 2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("120.55")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".40")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.28")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".240")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".101")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"基础安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 基础安装")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("准备 master 1台   node 2台 以下软件全部安装(要同一个内网)")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# lunix 安装必备的软件")]),t._v("\nyum install vim wget ntpdate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("y\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubernetes 会创建防火墙规则,先关闭firewalld")]),t._v("\nsystemctl stop firewalld & systemctl disable firewalld\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭 Swap 分区")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Swap 是 Linux 的交换分区，在系统资源不足时，Swap 分区会启用,这个我们不需要")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应该让新创建的服务自动调度到集群的其他 Node 节点中去，而不是使用 Swap 分区")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 临时关闭")]),t._v("\nswapoff "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("a\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭 Selinux")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭Selinux是为了支持容器可以访问宿主机文件系统")]),t._v("\nsetenforce 0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 统一我们的系统时间和时区")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 统一时区，为上海时区")]),t._v("\nln "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("snf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\nbash "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("c \"echo 'Asia/Shanghai' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(' /etc/timezone"\n\n'),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 统一使用阿里服务器进行时间更新")]),t._v("\nntpdate ntp1.aliyun.com\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 Docker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在 kubernetes 中的组件，服务都可以 Docker 镜像方式部署的,所以需要安装Docker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# device-mapper-persistent-data: 存储驱动，Linux上的许多高级卷管理技术")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# lvm: 逻辑卷管理器，用于创建逻辑磁盘分区使用")]),t._v("\nyum install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("y yum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("utils device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("persistent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data lvm2\n\nsudo yum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manager "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("add"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("repo http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//mirrors.aliyun.com/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ce/linux/centos/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ce.repo\n\nyum install docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ce "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("y\n\nsystemctl start docker\n\nsystemctl enable docker\n\nsudo mkdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p /etc/docker\n\nsudo tee /etc/docker/daemon.yamlon <<"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'EOF'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://fwvjnv59.mirror.aliyuncs.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nEOF\n\nsudo systemctl daemon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reload\n\nsudo systemctl restart docker.service\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Kubernetes")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切换阿里云源")]),t._v("\ncat <<EOF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" /etc/yum.repos.d/kubernetes.repo\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nname=Kubernetes\nbaseurl=http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//mirrors.aliyun.com/kubernetes/yum/repos/kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("el7"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//mirrors.aliyun.com/kubernetes/yum/doc/yum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key.gpg\n        http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//mirrors.aliyun.com/kubernetes/yum/doc/rpm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("package"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key.gpg\nEOF\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"kubernetes组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes组件","aria-hidden":"true"}},[this._v("#")]),this._v(" Kubernetes组件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("kubelet 是 Kubernetes 中的核心组件。它会运行在集群的所有节点上，并负责创建启动服务容器")]),this._v(" "),s("li",[this._v("kubectl 则是Kubernetes的命令行工具。可以用来管理，删除，创建资源")]),this._v(" "),s("li",[this._v("kubeadm 则是用来初始化集群，子节点加入的工具")]),this._v(" "),s("li",[this._v("其他的组件后面在处理")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  直接安装下面这个会有问题 k8s.gcr.io/coredns 版本下载有问题")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  yum install -y kubelet kubeadm kubectl")]),t._v("\nyum install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("y kubelet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.20.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("0 kubeadm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.20.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("0 kubectl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.20.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动kubelet")]),t._v("\nsystemctl enable kubelet && systemctl start kubelet\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"设置bridge-nf-call-iptables"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置bridge-nf-call-iptables","aria-hidden":"true"}},[this._v("#")]),this._v(" 设置bridge-nf-call-iptables")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("配置内核参数，将桥接的IPV4浏览传递到iptables链")]),this._v(" "),s("li",[this._v("开启了bridge-nf-call-iptables")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("echo 1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" /proc/sys/net/bridge/bridge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("call"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("iptables\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"master节点配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#master节点配置","aria-hidden":"true"}},[this._v("#")]),this._v(" Master节点配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("修改主机名称为 master")]),this._v(" "),s("li",[this._v("配置hosts")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[this._v("hostnamectl set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("hostname  master\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# ip addr 查看")]),this._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# vim /etc/hosts")]),this._v("\n172.31.178.169  master  master\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"配置-kubernetes-初始化文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-kubernetes-初始化文件","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置 Kubernetes 初始化文件")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("更换 Kubernetes 镜像仓库为阿里云镜像仓库，加速组件拉取")]),t._v(" "),a("li",[t._v("替换 ip 为自己主机 ip")]),t._v(" "),a("li",[t._v("配置 pod 网络为 flannel 网段")]),t._v(" "),a("li",[t._v("为了让集群之间可以互相通信，需要配置子网络,这些在后面的flannel网络中需要用到\n"),a("ul",[a("li",[t._v("10.96.0.0/12 是Kubernetes内部的网络pods需要的网络")]),t._v(" "),a("li",[t._v("10.244.0.0/16 是Kubernetes内部services需要的网络")])])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubeadm config print init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("defaults "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kubeadm.conf\nvim init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kubeadm.conf\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageRepository")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k8s.gcr.io 更换k8s镜像仓库\n+ imageRepository"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry.cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("hangzhou.aliyuncs.com/google_containers\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" localAPIEndpointc，advertiseAddress为master ip "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("port默认不修改\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localAPIEndpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n+ advertiseAddress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.31.178.169  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此处为master的IP(内网)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bindPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置子网络")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networking")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dnsDomain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster.local\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceSubnet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.96.0.0/12\n+ podSubnet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.244.0.0/16    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加这个")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"拉取其它组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拉取其它组件","aria-hidden":"true"}},[this._v("#")]),this._v(" 拉取其它组件")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("kubeadm 可以用来拉取我们的默认组件镜像")]),t._v(" "),a("li",[t._v("kube-apiserver 提供接口服务，可以让外网访问集群")]),t._v(" "),a("li",[t._v("kube-controller-manager 内部的控制指令工具")]),t._v(" "),a("li",[t._v("kube-scheduler 内部的任务调度器")]),t._v(" "),a("li",[t._v("kube-proxy 反向代理和负载均衡，流量转发")]),t._v(" "),a("li",[t._v("pause 进程管理工具")]),t._v(" "),a("li",[t._v("etcd 保持 集群内部的数据一致性")]),t._v(" "),a("li",[t._v("coredns 集群内网通信")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查看缺少的组件")]),t._v("\nkubeadm config images list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("config init"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("kubeadm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拉取缺少的组件")]),t._v("\nkubeadm config images pull "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("config init"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("kubeadm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"初始化-kubernetes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化-kubernetes","aria-hidden":"true"}},[this._v("#")]),this._v(" 初始化 Kubernetes")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("Master 节点需要执行的初始化命令")]),this._v(" "),s("li",[this._v("将默认的 Kubernetes 认证文件拷贝进 .kube 文件夹内，才能默认使用该配置文件")]),this._v(" "),s("li",[this._v("kubeadm join 可以快速将 Node 节点加入到 Master 集群内 (需要将.kube/config 拷贝到当前工作的目录内)")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubeadm init "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kubeadm.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -----------------以下是日志")]),t._v("\nYour Kubernetes control"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("plane has initialized successfully!\n\nTo start using your cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" you need to run the following as a regular user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n  mkdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p $HOME/.kube\n  sudo cp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("u)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$(id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("g) $HOME/.kube/config\n\nAlternatively"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" if you are the root user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" you can run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("podnetwork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v('.yaml" with one of the options listed at'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//kubernetes.io/docs/concepts/cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\nkubeadm join 172.31.178.169"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("6443 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token abcdef.0123456789abcdef \\\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("discovery"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("hash sha256"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8aac19f4dbe68f1e15ba3d80e141acdc912e353f9757ad69187e8fb9780bc975 \n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"如果上面的配置-终断了-删除文件-在重新init-安装kubernetes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果上面的配置-终断了-删除文件-在重新init-安装kubernetes","aria-hidden":"true"}},[this._v("#")]),this._v(" 如果上面的配置 终断了  删除文件 在重新init 安装Kubernetes")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[this._v("rm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("rf /etc/kubernetes/*\nrm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("rf ~/.kube/*\n\nkubeadm reset\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"安装-flannel"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-flannel","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装 Flannel")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("flannel 主要的作用是通过创建一个虚拟网络，让不同节点下的服务有着全局唯一的IP地址，且服务之前可以互相访问和连接。")]),this._v(" "),s("li",[this._v("集群内网网络通信协议通信模式采用了Flannel协议")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml")]),t._v("\nwget https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//img.zhufengpeixun.com/kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel.yml\ndocker pull quay.io/coreos/flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.13.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rc2\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel.yml\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("vim kube-flannel.yml 可以查看 flannel 网络配置和前面的初始化配置文件进行关联")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[this._v("net-conf.json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(":")]),this._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[this._v('\n    {\n      "Network": "10.244.0.0/16",\n      "Backend": {\n        "Type": "vxlan"\n      }\n    }')]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"查看master-启动情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看master-启动情况","aria-hidden":"true"}},[this._v("#")]),this._v(" 查看master 启动情况")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("查看启动情况,后面node 加入后 会多一条记录")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[this._v("kubectl get nodes\n\nNAME     STATUS   ROLES                  AGE     VERSION\nmaster   Ready    control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("plane"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("master   9m34s   v1.20.4\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"node节点配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node节点配置","aria-hidden":"true"}},[this._v("#")]),this._v(" Node节点配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("Node 节点的地位则是负责运行服务容器，负责接收调度的。")]),this._v(" "),s("li",[this._v("先执行基础安装")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[this._v("hostnamectl "),s("span",{pre:!0,attrs:{class:"token keyword"}},[this._v("set")]),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("-")]),this._v("hostname node1\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("将 master 节点的配置文件拷贝 k8s 到 node1 节点")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("scp $"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("config root@"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.31")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".178")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".170")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("在node1节点归档配置文件")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("mkdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p $"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("kube\nsudo mv $"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("config $"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("config\nsudo chown "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("config\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"加入-master-节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加入-master-节点","aria-hidden":"true"}},[this._v("#")]),this._v(" 加入 Master 节点")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("让 Node 节点加入到 master 集群内")]),this._v(" "),s("li",[this._v("如果 join 失败 阔以 执行kubeadm reset初始化在执行")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这是初始化 配置的时候 显示出来的 ")]),t._v("\nkubeadm join "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.16")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".81")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".164")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("token abcdef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0123456789")]),t._v("abcdef \\\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("discovery"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("token"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("hash sha256"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("b4a059eeffa2e52f2eea7a5d592be10c994c7715c17bda57bbc3757d4f13903d\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("如果刚才的命令丢了，可以在 master 机器上使用 kubeadm token create 重新生成一条命令")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[this._v("kubeadm token create "),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("--")]),this._v("print"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("-")]),this._v("join"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("-")]),this._v("command\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"安装-flannel-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-flannel-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装 Flannel")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("scp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/kube-flannel.yml root@172.31.178.170:~/")]),t._v("\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("flannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yml\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"查看状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看状态","aria-hidden":"true"}},[this._v("#")]),this._v(" 查看状态")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("kubectl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" nodes\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NAME")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STATUS")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ROLES")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AGE")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VERSION")]),t._v("\nmaster   Ready    control"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("master   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v("m    v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20.4")]),t._v("\nnode1    Ready    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),t._v("s   v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20.4")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"kubernetes介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes介绍","aria-hidden":"true"}},[this._v("#")]),this._v(" Kubernetes介绍")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("li",[t._v("Master是控制节点,负责编排、管理、调度用户提交的作业\n"),a("ul",[a("li",[t._v("负责API服务的"),a("code",[t._v("kube-apiserver")])]),t._v(" "),a("li",[t._v("负责调度的"),a("code",[t._v("kube-scheduler")])]),t._v(" "),a("li",[t._v("负责容器编排的"),a("code",[t._v("kube-controller-manager")])]),t._v(" "),a("li",[a("code",[t._v("kube-apiserver")]),t._v("会处理集群的持久化数据并保存在"),a("code",[t._v("etcd")]),t._v("中")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"制作简单的镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#制作简单的镜像","aria-hidden":"true"}},[this._v("#")]),this._v(" 制作简单的镜像")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"docker-build-index-html"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-build-index-html","aria-hidden":"true"}},[this._v("#")]),this._v(" docker/build/index.html")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[t._v("<!DOCTYPE html>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("X-UA-Compatible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("IE=edge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width, initial-scale=1.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Document"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    1号\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"docker-conf-nginx-conf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-conf-nginx-conf","aria-hidden":"true"}},[this._v("#")]),this._v(" docker/conf/nginx.conf")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这个不能删除")]),t._v("\nevents"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        worker_connections 1024;\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       80;\n        listen       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("80;\n        server_name  _;\n        root         /etc/nginx/html;\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"docker-dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-dockerfile","aria-hidden":"true"}},[this._v("#")]),this._v(" docker/Dockerfile")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("打包成镜像  docker build -t songge/nginx-dome1:1.0.0 ./Dockerfile")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[this._v("FROM nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[this._v("1.15")]),this._v("\nCOPY build /etc/nginx/html\nCOPY conf /etc/nginx/\nWORKDIR /etc/nginx/html\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"发布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布","aria-hidden":"true"}},[this._v("#")]),this._v(" 发布")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[this._v("docker login\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# songge songge  账号密码 https://hub.docker.com")]),this._v("\nLogin Succeeded\ndocker push songge/nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("dome1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(":")]),this._v("1.0.0\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pod","aria-hidden":"true"}},[this._v("#")]),this._v(" Pod")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("Pod 是 K8S 中最小的可调度单元（可操作/可部署单元）")]),t._v(" "),a("li",[t._v("它里面可以包含1个或者多个 Docker 容器")]),t._v(" "),a("li",[t._v("在 Pod 内的所有 Docker 容器，都会共享同一个网络、存储卷、端口映射规则")]),t._v(" "),a("li",[t._v("一个 Pod 拥有一个 IP,但这个 IP 会随着Pod的重启，创建，删除等跟着改变，所以不固定且不完全可靠,这也就是 Pod 的 IP 漂移问题。这个问题我们可以使用下面的 Service 去自动映射")]),t._v(" "),a("li",[t._v("Pod 是一个容器组，里面有很多容器，容器组内共享资源")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployment","aria-hidden":"true"}},[this._v("#")]),this._v(" deployment")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("希望批量启动和管理多个Pod实例，就可以使用deployment")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"创建-deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建-deployment","aria-hidden":"true"}},[this._v("#")]),this._v(" 创建 deployment")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("mkdir deployment && cd deployment")]),this._v(" "),s("li",[this._v("vim deployment-user-v1.yaml")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#API 配置版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源类型")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#告诉deployment根据规则匹配相应的Pod进行控制和管理，matchLabels字段匹配Pod的label值")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#声明一个 Pod,副本的数量")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Pod的名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#组内创建的 Pod 信息")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器的名称")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" songge/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dome1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用哪个镜像")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器内映射的端口")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"部署-deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署-deployment","aria-hidden":"true"}},[this._v("#")]),this._v(" 部署 deployment")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("kubectl apply -f deployment-user-v1.yaml")]),t._v(" "),a("li",[t._v("查看部署的 deploment\n"),a("ul",[a("li",[t._v("kubectl get deploy  user-v1(过滤可选,deploment的名字)")])])]),t._v(" "),a("li",[t._v("查看部署的pod")]),t._v(" "),a("li",[t._v("kubectl get pods")]),t._v(" "),a("li",[t._v("查看pod的详情")]),t._v(" "),a("li",[t._v("kubectl describe pod user-v1-5895c69847-lzpg6")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("    kubectl get deploy\nNAME      READY   UP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("TO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("DATE   AVAILABLE   AGE\nuser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1   3/3     3            3           2m30s\n\n    kubectl get pods\nNAME                       READY   STATUS    RESTARTS   AGE\nuser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("5895c69847"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("lzpg6   1/1     Running   0          11s\nuser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("5895c69847"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("m7q88   1/1     Running   0          11s\nuser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("5895c69847"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pgqnb   1/1     Running   0          11s\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service","aria-hidden":"true"}},[this._v("#")]),this._v(" Service")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("有了Pod实例后就需要以固定的IP地址以负载均衡的方式访问多个Pod实例，就有了Service")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"创建服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建服务","aria-hidden":"true"}},[this._v("#")]),this._v(" 创建服务")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("deployment 是无状态的")]),t._v(" "),a("li",[t._v("deployment 并不会对 pod 进行网络通信和分发")]),t._v(" "),a("li",[t._v("Pod 的 IP 在运行时还会经常进行漂移且不固定")]),t._v(" "),a("li",[t._v("想访问服务需要使用 Service 组织统一的 Pod 访问入口")]),t._v(" "),a("li",[t._v("可以定义Service 来进行统一组织 Pod 服务访问")]),t._v(" "),a("li",[t._v("负责自动调度和组织deployment中 Pod 的服务访问，由于自动映射 Pod 的IP，同时也解决了 Pod 的IP漂移问题")]),t._v(" "),a("li",[t._v("创建一个service\n"),a("ul",[a("li",[t._v("protocol\t通信类型（TCP/UDP）")]),t._v(" "),a("li",[t._v("targetPort\t原本 Pod 开放的端口")]),t._v(" "),a("li",[t._v("port\tKubernetes容器之间互相访问的端口")]),t._v(" "),a("li",[t._v("type\tNodePort，Service的一种访问方式")]),t._v(" "),a("li",[t._v("nodePort  指定service 的开放端口(若没有则 随机给 范围30000-32000多)")])])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir service-user-v1.yaml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这个和pod的名称对应上")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30001 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 若不写 则随机给一个 30000-32000中间的一个")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NodePort\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("创建应用")]),this._v(" "),s("li",[this._v("kubectl apply -f service-user-v1.yaml")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"查看服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看服务","aria-hidden":"true"}},[this._v("#")]),this._v(" 查看服务")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("kubectl get svc")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("NAME              TYPE        CLUSTER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP      EXTERNAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP   PORT(S)        AGE\nservice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1   NodePort    10.110.219.57   <none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("        80"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("30001/TCP   2m12s\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("访问")]),this._v(" "),s("li",[this._v("可以在任何节点上访问 curl http://ip:30001")]),this._v(" "),s("li",[this._v("公网ip:30001 就能访问到部署的 deployment 里面的 pod")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("NAME                                 TYPE        CLUSTER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP       EXTERNAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP   PORT(S)                      AGE\ningress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("controller             NodePort    10.110.159.227   <none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("        80"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("31234/TCP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("443"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("31245/TCP   8d\ningress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admission   ClusterIP   10.111.176.223   <none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("        443/TCP                      8d\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"编写-ingress配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编写-ingress配置文件","aria-hidden":"true"}},[this._v("#")]),this._v(" 编写 ingress配置文件")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("ingress 服务的配置也是使用 yaml 文件进行管理")]),t._v(" "),a("li",[t._v("annotations 是 ingress 的主要配置项目，可以用来修改这些配置来修改 ingress 的行为。我们可以通过修改这些配置来实现灰度发布，跨域资源，甚至将 www.abc.com 重定向到 abc.com")]),t._v(" "),a("li",[t._v("rules 是 ingress 配置路径转发规则的地方,当我们去访问 /front 时， ingress 就会帮我们调度到 front-service-v1 这个 service 上面")]),t._v(" "),a("li",[t._v("path 可以是一个路径字符串，也可以是一个正则表达式")]),t._v(" "),a("li",[t._v("backend 则是 k8s 的 service 服务， serviceName 是服务名称， servicePort 是服务端口")]),t._v(" "),a("li",[t._v("backend 可以用来给 ingress 设置默认访问的 Service 服务。当请求不匹配 rules 中任何一条规则时，则会去走 backend 中的配置")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi ingress.yaml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Ingress\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("demo\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx.ingress.kubernetes.io/rewrite-target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetes.io/ingress.class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /user\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" svc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servicePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /pay\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" svc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servicePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80    ")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" svc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servicePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"查看-ingress-nginx和普通pod-操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看-ingress-nginx和普通pod-操作","aria-hidden":"true"}},[this._v("#")]),this._v(" 查看 ingress-nginx和普通pod 操作")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("创建应用服务")]),t._v(" "),a("li",[t._v("kubectl apply -f ./ingress.yaml")]),t._v(" "),a("li",[t._v("此时可以通过 公网IP:30001/user 访问到 service-user-v1 service")]),t._v(" "),a("li",[t._v("查看 ingress 详情")]),t._v(" "),a("li",[t._v("kubectl  describe ingress")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看ingress节点情况")]),t._v("\nkubectl get pod "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("n ingress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("o wide\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看节点详细情况 ")]),t._v("\nkubectl describe pod "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("n ingress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx ingress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admission"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("create"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("bfjt9\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看当前的deployment")]),t._v("\nkubectl get deploy \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除deploy 删除后ReplicateSet和pod也没有了")]),t._v("\nkubectl delete deploy nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看Replication Controller")]),t._v("\nkubectl get rc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除Replication Controller,删除后Pod也没有了")]),t._v("\nkubectl delete rc mysql\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看pod")]),t._v("\nkubectl get pod\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除pod")]),t._v("\nkubectl delete pod mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("77w7z\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看服务")]),t._v("\nkubectl get svc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除服务")]),t._v("\nkubectl delete service nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看pod详情")]),t._v("\nkubectl describe pod fail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1034443984"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("jerry\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"灰度发布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#灰度发布","aria-hidden":"true"}},[this._v("#")]),this._v(" 灰度发布")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"根据-cookie-切分流量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#根据-cookie-切分流量","aria-hidden":"true"}},[this._v("#")]),this._v(" 根据 Cookie 切分流量")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("基于 Cookie 切分流量。这种实现原理主要根据用户请求中的 Cookie 是否存在灰度标示 Cookie去判断是否为灰度用户，再决定是否返回灰度版本服务")]),this._v(" "),s("li",[this._v("nginx.ingress.kubernetes.io/canary：可选值为 true / false 。代表是否开启灰度功能")]),this._v(" "),s("li",[this._v("nginx.ingress.kubernetes.io/canary-by-cookie：灰度发布 cookie 的 key。当 key 值等于 always 时，灰度触发生效。等于其他值时，则不会走灰度环境")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"准备新版本service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备新版本service","aria-hidden":"true"}},[this._v("#")]),this._v(" 准备新版本Service")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cp deployment-user-v1.yaml deployment-user-v2.yaml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#API 配置版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源类型")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n+  name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v2     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n+      app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#告诉deployment根据规则匹配相应的Pod进行控制和管理，matchLabels字段匹配Pod的label值")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#声明一个 Pod,副本的数量")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n+        app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Pod的名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#组内创建的 Pod 信息")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器的名称")]),t._v("\n+        image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" songge/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dome2\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器内映射的端口")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# service-user-v2.yaml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n+  name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n+    app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NodePort\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f deployment-user-v2.yaml service-user-v2.yaml")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"配置-ingress-gray"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-ingress-gray","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置 ingress-gray")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("kubectl apply -f ./ingress-gray.yaml")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("vim ingress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gray.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Ingress\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("canary\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetes.io/ingress.class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx.ingress.kubernetes.io/rewrite-target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx.ingress.kubernetes.io/canary")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx.ingress.kubernetes.io/canary-by-cookie")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vip_user"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认走这里 cookie ")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" svc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servicePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加 cookie 走这里")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" svc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servicePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("code",[this._v('curl --cookie "vip_user=always" http://47.100.74.198:31234/user')]),this._v(" "),s("ul",[s("li",[this._v("如果加了 cookie 配置他会访问 灰度配置的路由,否则就访问原来的路由")])])]),this._v(" "),s("li",[s("code",[this._v("curl http://47.100.74.198:31234/user")])]),this._v(" "),s("li",[s("code",[this._v("curl http://47.100.74.198:31234")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"基于-header-切分流量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于-header-切分流量","aria-hidden":"true"}},[this._v("#")]),this._v(" 基于 Header 切分流量")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("基于 Header 切分流量，这种实现原理主要根据用户请求中的 header 是否存在灰度标示 header去判断是否为灰度用户，再决定是否返回灰度版本服务。")]),this._v(" "),s("li",[this._v("vi ingress-gray.yaml")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Ingress\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("canary\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetes.io/ingress.class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx.ingress.kubernetes.io/rewrite-target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx.ingress.kubernetes.io/canary")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx.ingress.kubernetes.io/canary-by-header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx.ingress.kubernetes.io/canary-by-header-value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vip"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" svc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servicePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" svc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servicePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("code",[this._v("curl --header 'name:vip' http://47.100.74.198:31234/user")]),this._v(" "),s("ul",[s("li",[this._v("如果加了 cookie 配置他会访问 灰度配置的路由,否则就访问原来的路由")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"基于权重切分流量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于权重切分流量","aria-hidden":"true"}},[this._v("#")]),this._v(" 基于权重切分流量")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("code",[this._v('nginx.ingress.kubernetes.io/canary-weight: "50"')])]),this._v(" "),s("li",[s("code",[this._v("for ((i=1; i<=10; i++)); do curl 127.0.0.1:端口值;echo; done")])]),this._v(" "),s("li",[s("code",[this._v("for ((i=1; i<=10; i++)); do curl http://47.100.74.198:31234;echo; done")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"优先级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优先级","aria-hidden":"true"}},[this._v("#")]),this._v(" 优先级")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("canary-by-header -> canary-by-cookie -> canary-weight")]),this._v(" "),s("li",[this._v("k8s 会优先去匹配 header ，如果未匹配则去匹配 cookie ，最后是 weight")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"滚动发布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#滚动发布","aria-hidden":"true"}},[this._v("#")]),this._v(" 滚动发布")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("k8s每次使用一个新的副本控制器(replication controller)来替换已存在的副本控制器，从而始终使用一个新的Pod模板来替换旧的pod模板\n"),s("ul",[s("li",[this._v("创建一个新的replication controller")]),this._v(" "),s("li",[this._v("增加或减少pod副本数量，直到满足当前批次期望的数量")]),this._v(" "),s("li",[this._v("删除旧的replication controller")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"发布流程和策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布流程和策略","aria-hidden":"true"}},[this._v("#")]),this._v(" 发布流程和策略")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("优点\n"),a("ul",[a("li",[t._v("不需要停机更新，无感知平滑更新。")]),t._v(" "),a("li",[t._v("版本更新成本小,不需要新旧版本共存")])])]),t._v(" "),a("li",[t._v("缺点\n"),a("ul",[a("li",[t._v("更新时间长：每次只更新一个/多个镜像，需要频繁连续等待服务启动缓冲")]),t._v(" "),a("li",[t._v("旧版本环境无法得到备份：始终只有一个环境存在")]),t._v(" "),a("li",[t._v("回滚版本异常痛苦：如果滚动发布到一半出了问题，回滚时需要使用同样的滚动策略回滚旧版本")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"先扩容为10个副本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#先扩容为10个副本","aria-hidden":"true"}},[this._v("#")]),this._v(" 先扩容为10个副本")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[this._v("kubectl get deploy\nkubectl scale deployment nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("1  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("replicas=10\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置文件")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("minReadySeconds")]),t._v(" "),a("ul",[a("li",[t._v("容器接受流量延缓时间：单位为秒，默认为0。如果没有设置的话，k8s会认为容器启动成功后就可以用了。设置该值可以延缓容器流量切分")])])]),t._v(" "),a("li",[a("code",[t._v("strategy.type = RollingUpdate")]),t._v(" "),a("ul",[a("li",[t._v("ReplicaSet 发布类型，声明为滚动发布，默认也为滚动发布")])])]),t._v(" "),a("li",[a("code",[t._v("strategy.rollingUpdate.maxSurge")]),t._v(" "),a("ul",[a("li",[t._v("最多Pod数量：为数字类型/百分比。如果 maxSurge 设置为1，replicas 设置为10，则在发布过程中pod数量最多为10 + 1个（多出来的为旧版本pod，平滑期不可用状态）。maxUnavailable 为 0 时，该值也不能设置为0")])])]),t._v(" "),a("li",[a("code",[t._v("strategy.rollingUpdate.maxUnavailable")]),t._v(" "),a("ul",[a("li",[t._v("升级中最多不可用pod的数量：为数字类型/百分比。")]),t._v(" "),a("li",[t._v("当 maxSurge 为 0 时，该值也不能设置为0。")])])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 增加")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minReadySeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RollingUpdate\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rollingUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxSurge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxUnavailable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 增加后的     ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#API 配置版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源类型")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1     ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minReadySeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RollingUpdate\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rollingUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxSurge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxUnavailable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#告诉deployment根据规则匹配相应的Pod进行控制和管理，matchLabels字段匹配Pod的label值")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#声明一个 Pod,副本的数量")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Pod的名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#组内创建的 Pod 信息")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器的名称")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" songge/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dome3 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用哪个镜像")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器内映射的端口")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("保存后 监控&&查看效果")]),this._v(" "),s("li",[s("code",[this._v("kubectl apply -f ./depnginx1.yaml && kubectl rollout status deployment/nginx-1")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"另一种发布模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#另一种发布模式","aria-hidden":"true"}},[this._v("#")]),this._v(" 另一种发布模式")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("在 Kubernetes 中，有一种发布方式为 Recreate 。这种发布方式比较暴力，它会直接把所有旧的 Pod 全部杀死。杀死后再批量创建新的 Pod 。")]),this._v(" "),s("li",[this._v("我们只需要将  strategy.type  改为 Recreate 即可：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[this._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(":")]),this._v(" Recreate\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"kubectl-rollout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubectl-rollout","aria-hidden":"true"}},[this._v("#")]),this._v(" kubectl rollout")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("kubectl rollout 命令可以用来操纵 deployment 的资源进行管理。包括对版本的快速回退，暂停/恢复版本更新，根据更新历史回退版本等功能。")]),t._v(" "),a("li",[t._v("暂停\n"),a("ul",[a("li",[a("code",[t._v("kubectl rollout pause deployment/名称")])])])]),t._v(" "),a("li",[t._v("继续\n"),a("ul",[a("li",[a("code",[t._v("kubectl rollout resume deployment/名称")])])])]),t._v(" "),a("li",[t._v("查看一个 deployment 的发布状态：\n"),a("ul",[a("li",[a("code",[t._v("kubectl rollout status deployment/名称")])])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"kubernetes-secret：储存你的机密信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-secret：储存你的机密信息","aria-hidden":"true"}},[this._v("#")]),this._v(" Kubernetes Secret：储存你的机密信息")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"secret-的几种类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secret-的几种类型","aria-hidden":"true"}},[this._v("#")]),this._v(" Secret 的几种类型")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"opaque-类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#opaque-类型","aria-hidden":"true"}},[this._v("#")]),this._v(" Opaque 类型")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("第一种是 opaque 类型，这种类型比较常用，一般拿来存放密码，密钥等信息，存储格式为 base64 。但是请注意：base64并不是加密格式，依然可以通过decode来解开它。")]),t._v(" "),a("li",[a("code",[t._v("kubectl create secret generic")]),t._v(" 命令式创建\n"),a("ul",[a("li",[t._v("default-auth 为 自定义的名称")]),t._v(" "),a("li",[t._v("--from-literal 的后面则跟随一组 key=value")])])]),t._v(" "),a("li",[a("code",[t._v("kubectl create secret generic default-auth --from-literal=username=sg --from-literal=password=123456")])]),t._v(" "),a("li",[a("code",[t._v("kubectl get secret")]),t._v(" 查看")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("NAME                  TYPE                                  DATA   AGE\ndefault"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth          Opaque                                2      7s\ndefault"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kqdc8   kubernetes.io/service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("account"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token   3      7d\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("code",[this._v("kubectl edit secret default-auth")]),this._v(" 编辑")]),this._v(" "),s("li",[this._v("这里也可以用 kubectl get secret [secret名称] -o yaml 命令，将内容打印到终端上查看。其中 -o yaml 代表输出为 yaml 格式内容，当然也可以输出 json 等格式内容")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Please edit the object below. Lines beginning with a '#' will be ignored,")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# and an empty file will abort the edit. If an error occurs while saving this file will be")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# reopened with the relevant failures.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MTIzNDU2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" c2c=\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-09-25T08:58:52Z"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"942128"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4214d3eb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2f33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("421d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("bdd0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("98cf593c0807\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Opaque\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("p",[t._v("这里可以使用 Linux 自带的 base64 命令进行解码。其中 -d 代表 --decode，解码的意思")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("echo MTIzNDU2 | base64 -d")]),t._v(" 查看")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("echo c2c= | base64 -d")]),t._v(" 查看")])]),t._v(" "),a("li",[a("p",[t._v("声明式创建")])]),t._v(" "),a("li",[a("p",[t._v("vim admin-auth.yaml")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stringData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sg\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 123@1234\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Opaque\n\n\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth.yaml\nkubectl get secret admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("o yaml\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"私有镜像库认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#私有镜像库认证","aria-hidden":"true"}},[this._v("#")]),this._v(" 私有镜像库认证")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("第二种是私有镜像库认证类型，这种类型也比较常用，一般在拉取私有库的镜像时使用。")]),this._v(" "),s("li",[this._v("在这里我们依然可以通过命令行进行创建。只不过类型变成了 docker-registry")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("vim docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry.yaml\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [] 要去掉  server 要写仓库的端口")]),t._v("\nkubectl create secret docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry private"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry \\\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("username="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("email="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("123@qq.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8082")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置私有的 建议这个")]),t._v("\nkubectl create secret docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry private"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry \\\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("username=admin \\\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password=Sg920322 \\\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("email=501798525@qq.com \\\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=106.15.106.83"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8082")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者直接拿取docker配置")]),t._v("\nkubectl create secret generic regcred  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file=.dockerconfigjson=/root/.docker/config.json "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("type=kubernetes.io/dockerconfigjson\n\nkubectl get secret private"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("o yaml\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("可以看到，k8s 自动帮我们填写了一个key，为 .dockerconfigjson ；value则是一串 base64 值。我们依然可以使用 base64 -d 命令查看下里面到底是啥：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("echo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" base64 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("d\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("当然，私有镜像库密钥组也可以通过配置文件创建。编辑文件名为 private-registry-file.yaml 文件，并输入以下内容：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" private"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v(".dockerconfigjson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" eyJhdXRocyI6eyJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOnsidXNlcm5hbWUiOiJhZG1pbiIsInBhc3N3b3JkIjoiMzY3NzM0IiwiZW1haWwiOiJqYW5sYXk4ODQxODEzMTdAZ21haWwuY29tIiwiYXV0aCI6IllXUnRhVzQ2TXpZM056TTAifX19\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes.io/dockerconfigjson\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("在这里， data内的字段必须为 .dockerconfigjson，值则是一串 dockerconfigjson 的 base64 值；type 则为 kubernetes.io/dockerconfigjson ，意思是声明一份 dockerconfig 的配置")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f ./private"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file.yaml\nkubectl get secret private"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("o yaml\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"密钥的使用方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#密钥的使用方法","aria-hidden":"true"}},[this._v("#")]),this._v(" 密钥的使用方法")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("上面我们写了如何声明一个 Secret。在声明后，我们需要在实际的配置中使用，才有实际意义。在 K8S 中，一共有三种可以使用 Secret 的方式。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"volume-挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#volume-挂载","aria-hidden":"true"}},[this._v("#")]),this._v(" Volume 挂载")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("第一种是通过存储卷的方式挂载进去。我们可以编辑下 "),s("code",[this._v("depnginx1.yaml")]),this._v(" 的 deployment 配置文件去配置下。")]),this._v(" "),s("li",[this._v("第一步：在Pod层面设置一个外部存储卷，存储卷类型为 secret 。在 template.spec 下填写。这里代表声明了一个外置存储卷，存储卷名称为 admincert ，类型为 secret；Secret 的名称为 admin-auth ：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admincert\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("第二步：在容器配置配置存储卷。在 containers.name[] 下填写字段 volumeMounts 。这里的 name 值和上面的卷名是对应的。 mountPath 是要挂载到容器内哪个目录下，这里代表挂载到用户目录下； readonly 则代表文件是不是只读：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admincert\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /root\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("readOnly")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("修改 vim depnginx1.yaml 配置")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#API 配置版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源类型")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1     ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minReadySeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RollingUpdate\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rollingUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxSurge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxUnavailable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#告诉deployment根据规则匹配相应的Pod进行控制和管理，matchLabels字段匹配Pod的label值")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Pod的名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#组内创建的 Pod 信息")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器的名称")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" songge/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dome3 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用哪个镜像")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admincert\n           "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /root\n           "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("readOnly")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器内映射的端口")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admincert\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("在运行正常的情况下，我们可以使用 kubectl exec 命令在 Pod 容器内执行我们要执行的命令。在这里，我们查看下 Pod 镜像内的 /root 文件夹里面都有啥文件：")]),t._v(" "),a("li",[a("code",[t._v("kubectl exec 命令格式：kubectl exec [POD] -- [COMMAND]")])]),t._v(" "),a("li",[a("code",[t._v("kubectl exec -it [POD_NAME] -- ls /root")]),t._v(" 或者 "),a("code",[t._v("kubectl exec -it [POD_NAME] /bin/bash")])]),t._v(" "),a("li",[t._v("kubectl exec -it [POD_NAME] -- cat /root/password")]),t._v(" "),a("li",[t._v("kubectl exec -it [POD_NAME] -- cat /root/username")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"环境变量注入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境变量注入","aria-hidden":"true"}},[this._v("#")]),this._v(" 环境变量注入")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("第二种是将 Secret 注入进容器的环境变量。同样需要配置下 deployment 文件。找到 containers ，下面新加一个 env 字段：")]),this._v(" "),s("li",[this._v("其中， env[].name 为环境变量的 key ， valueFrom 为值； secretKeyRef 则代表是一个 Secret 类型的 value。")]),this._v(" "),s("li",[this._v("secretKeyRef.name  则是要引用的 secret 的名称，key 则是 secret 中配置的 key 值。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" USERNAME\n  \t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  \t\t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    \t\t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n      \t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" username\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PASSWORD\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      \t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" password\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#API 配置版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源类型")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1     ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minReadySeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RollingUpdate\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rollingUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxSurge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxUnavailable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#告诉deployment根据规则匹配相应的Pod进行控制和管理，matchLabels字段匹配Pod的label值")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Pod的名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#组内创建的 Pod 信息")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器的名称")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" USERNAME\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n               "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n               "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" username\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PASSWORD\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n               "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n               "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" password\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" songge/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dome3 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用哪个镜像        ")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器内映射的端口")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admincert\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f ./v1.yaml\nkubectl get pods\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看所有的环境变量")]),t._v("\nkubectl exec "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("it nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("5864ff7"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("55hc7 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" env\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打印")]),t._v("\necho $USERNAME\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看所有环境变量")]),t._v("\nenv\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"docker-私有库认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-私有库认证","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker 私有库认证")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("第三种是 Docker 私有库类型，这种方法只能用来配置 私有镜像库认证。")]),this._v(" "),s("li",[this._v("首先，我们先尝试不加认证去拉取一个私有库镜像。编辑下 "),s("code",[this._v("depnginx1.yaml")]),this._v(" 的 deployment，把镜像换成私有库的镜像。保存后使用 kubectl apply 生效配置：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("镜像库地址"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("/jenkins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看状态")]),t._v("\nkubectl get pods\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("可以看到， "),a("code",[t._v("depnginx1.yaml")]),t._v("  的 Pod 并无法拉取下来镜像。我们使用 kubectl describe 命令查看下该 Pod 的具体状态：")]),t._v(" "),a("li",[t._v("找到 Events 那一块，可以其中一条 message 写着：unauthorized: access to the requested resource is not authorized（要请求的资源没有认证）。此时不登录，无法拉取私有镜像。")]),t._v(" "),a("li",[t._v("这里我们需要配置下 deployment 文件。")]),t._v(" "),a("li",[t._v("找到 spec ，下面新加一个 imagePullSecrets 字段。该字段代表了在拉取Pod所需要的镜像时，需要的认证信息。其中，name 字段为上面我们配置过的私有镜像库认证名。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullSecrets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" private"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在执行")]),t._v("\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f xxx\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"configmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configmap","aria-hidden":"true"}},[this._v("#")]),this._v(" ConfigMap")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("统一管理服务环境变量")]),this._v(" "),s("li",[this._v("Kubernetes Secret 的主要作用是来存放密码，密钥等机密信息")]),this._v(" "),s("li",[this._v("对于环境变量的配置：例如你的数据库地址，负载均衡要转发的服务地址等信息。这部分内容使用 Secret 显然不合适，打包在镜像内耦合又太严重。这里，我们可以借助 Kubernetes ConfigMap 来配置这项事情")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"什么是-configmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-configmap","aria-hidden":"true"}},[this._v("#")]),this._v(" 什么是 ConfigMap")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("ConfigMap 是 Kubernetes 的一种资源类型，我们可以使用它存放一些环境变量和配置文件")]),this._v(" "),s("li",[this._v("信息存入后，我们可以使用挂载卷的方式挂载进我们的 Pod 内，也可以通过环境变量注入")]),this._v(" "),s("li",[this._v("和 Secret 类型最大的不同是，存在 ConfigMap 内的内容不会加密")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1、创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建","aria-hidden":"true"}},[this._v("#")]),this._v(" 1、创建")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("命令行直接创建")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("fll= create configmap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("literal="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nkubectl create configmap mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("literal=MYSQL_HOST=192.168.1.172 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("literal=MYSQL_PORT=3306\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("需要注意，configmap 的名称必须是全小写，特殊符号只能包含 '-' 和 '.'。可以用下面的这个正则表达式校验下看看符不符合规则："),a("a",{attrs:{href:"%5B-a-z0-9%5D*%5Ba-z0-9%5D"}},[t._v("a-z0-9")]),t._v("?(."),a("a",{attrs:{href:"%5B-a-z0-9%5D*%5Ba-z0-9%5D"}},[t._v("a-z0-9")]),t._v("?)*')")]),t._v(" "),a("li",[a("code",[t._v("configmap")]),t._v(" 简写 cm")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[this._v("kubectl get cm\nkubectl describe cm mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("config\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2、配置清单创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、配置清单创建","aria-hidden":"true"}},[this._v("#")]),this._v(" 2、配置清单创建")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("kind 的值为 ConfigMap,代表声明一个 ConfigMap 类型的资源")]),this._v(" "),s("li",[this._v("metadata.name 代表是该 configmap 的名称")]),this._v(" "),s("li",[this._v("data 是存放数据的地方，数据格式为 key:value")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ConfigMap\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.1.172"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3306"')]),t._v("\n\n\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f ./mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file.yaml\nkubectl describe cm mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3、文件创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、文件创建","aria-hidden":"true"}},[this._v("#")]),this._v(" 3、文件创建")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("--from-file")]),t._v("代表一个文件")]),t._v(" "),a("li",[a("code",[t._v("key")]),t._v("是文件在 "),a("code",[t._v("configmap")]),t._v(" 内的 "),a("code",[t._v("key")])]),t._v(" "),a("li",[a("code",[t._v("file_path")]),t._v(" 是文件的路径")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubectl create configmap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("configname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("file_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("env.config")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("HOST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.0.1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\nkubectl create configmap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("configname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file=env=./env.config\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# configmap/env-from-file created")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -o yaml 输出成 yaml 格式")]),t._v("\nkubectl get cm env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("o yaml\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n    L: 172.168.81.111\n    PATH: /root/abcd/efg")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ConfigMap\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-09-26T02:32:36Z"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("managedFields")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldsType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" FieldsV1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldsV1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("f:data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("f:env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("manager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubectl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("create\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Update\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-09-26T02:32:36Z"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1040172"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 35b672f8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("461b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("4713"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("bc3f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("92a7a2691c22\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"目录创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#目录创建","aria-hidden":"true"}},[this._v("#")]),this._v(" 目录创建")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("也可以直接将一个目录下的文件整个存入进去")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubectl create configmap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("configname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dir_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("创建文件")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[this._v("mkdir env && cd ./env\necho 'local' "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(">")]),this._v(" env.local\necho 'test' "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(">")]),this._v(" env.test\necho 'prod' "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(">")]),this._v(" env.prod\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("执行")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubectl create configmap env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file=./\nkubectl get cm env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("o yaml\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"环境变量注入-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境变量注入-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 环境变量注入")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("注入到环境变量是一种比较常见的方式。在这里，我们编辑下 "),s("code",[this._v("depnginx1.yaml")]),this._v(" 的 deployment 配置文件，来将 configmap 注入进环境变量内：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MYSQL_HOST\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMapKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MYSQL_HOST\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("//kubectl exec "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("POD_NAMEex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" env "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" grep MYSQL_HOST\nkubectl exec  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("it user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("744f48d6bd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("9klqr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" env "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" grep MYSQL_HOST\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 找不到 上面key 只配置了MYSQL_HOST")]),t._v("\nkubectl exec  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("it nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("6f69565599"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("6hmvq  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" env "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" grep MYSQL_PORT\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"存储卷挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#存储卷挂载","aria-hidden":"true"}},[this._v("#")]),this._v(" 存储卷挂载")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("第二种方式是存储卷挂载。这种方式会将 configmap 里内容中的每个 key 和 value，以独立文件方式以外部挂载卷方式挂载进去（ key 是文件名，value 是文件内容）。这部分的用法和 Secret 的用法很像")]),this._v(" "),s("li",[this._v("第一步：在 Pod 层面声明一个外部存储卷。 name 为存储卷名称；configMap 代表存储卷的文件来源为 configMap ； configMap.name 要填入要加载的 configMap 名称。位置如图所示：")]),this._v(" "),s("li",[this._v("第二步：在容器镜像层面配置存储卷。 name 的值来源于第一步配置的 name 值； mountPath 为要挂载的目录；readonly 则代表文件是不是只读。位置如图所示：")]),this._v(" "),s("li",[this._v("我们编辑下 depnginx-1 的 deployment 配置文件，修改下配置：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envfiles\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dir\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envfiles\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /root/\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("readOnly")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#API 配置版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源类型")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1     ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minReadySeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RollingUpdate\n   "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rollingUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxSurge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxUnavailable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#告诉deployment根据规则匹配相应的Pod进行控制和管理，matchLabels字段匹配Pod的label值")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Pod的名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#组内创建的 Pod 信息")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器的名称`:")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" songge/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dome3 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用哪个镜像        ")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envfiles\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /root/\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("readOnly")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器内映射的端口")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envfiles\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dir\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("但是，这种方式每次挂载都要将整个文件夹挂载进去，我们如何一次只挂载单个文件呢？这里我们可以借助 volumes.configMap.items[] 字段来配置多个 item 项：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envfiles\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dir\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("items")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" env.local\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" env.local\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" env.test\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" env.test\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("这里的 item 是个数组，每一项都是一条 ConfigMap 里的独立字段。")])]),this._v(" "),s("li",[s("p",[this._v("其中， key 是 ConfigMap 中的字段名称； path 则是要挂载的路径（相对于在容器镜像层面配置存储卷配置的 mountPath 字段）。填写保存后退出生效")])]),this._v(" "),s("li",[s("p",[this._v("接着我们用 kubectl exec 命令验证下挂载结果")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"服务发现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务发现","aria-hidden":"true"}},[this._v("#")]),this._v(" 服务发现")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("当A服务依赖另一个 B服务,而我们常常不知道 B服务 的端口和IP，且端口和IP也相对不固定有可能经常更改")]),this._v(" "),s("li",[this._v("这时候，我们就需要服务发现")]),this._v(" "),s("li",[this._v("服务发现是指使用一个注册中心来记录分布式系统中的全部服务的信息，以便其他服务能够快速的找到这些已注册的服务")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"coredns"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#coredns","aria-hidden":"true"}},[this._v("#")]),this._v(" CoreDNS")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("Pod 的 IP 常常是漂移且不固定的，所以我们要使用 Service 这个神器来将它的访问入口固定住")]),t._v(" "),a("li",[t._v("可以利用 DNS 的机制给每个 Service 加一个内部的域名，指向其真实的IP")]),t._v(" "),a("li",[t._v("在Kubernetes中，对 Service 的服务发现，是通过一种叫做 CoreDNS 的组件去实现的")]),t._v(" "),a("li",[t._v("coreDNS 是使用 Go 语言实现的一个DNS服务器\n"),a("ul",[a("li",[t._v("-n 按命名空间过滤")]),t._v(" "),a("li",[t._v("-l 按标签过滤")]),t._v(" "),a("li",[t._v("-o wide 输出额外信息。对于Pod，将输出Pod所在的Node名")])])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubectl "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("n kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system get all  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("l k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app=kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dns "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("o wide\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"服务发现规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务发现规则","aria-hidden":"true"}},[this._v("#")]),this._v(" 服务发现规则")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("kubectl exec 的作用是可以直接在容器内执行Shell脚本\n"),s("ul",[s("li",[this._v("命令格式：kubectl exec -it [PodName] -- [Command]")]),this._v(" "),s("li",[this._v("-i：即使没有连接，也要保持标准输入保持打开状态。一般与 -t 连用。")]),this._v(" "),s("li",[this._v("-t：分配一个伪TTY（终端设备终端窗口），一般与 -i 连用。可以分配给我们一个Shell终端")])])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubectl get pods\nkubectl get svc\nkubectl exec "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("it user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("688486759f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("9snpx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /bin/sh\ncurl http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v2\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("namespace(命名空间)\n"),a("ul",[a("li",[t._v("kubernetes namespace（命名空间）是 kubernetes 里比较重要的一个概念")]),t._v(" "),a("li",[t._v("在启动集群后，kubernetes 会分配一个默认命名空间，叫default。不同的命名空间可以实现资源隔离，服务隔离，甚至权限隔离")]),t._v(" "),a("li",[t._v("因为我们在之前创建的服务，都没有指定 namespace ，所以我们的服务都是在同一个 namespace default下")]),t._v(" "),a("li",[t._v("在同 namespace 下的规则，我们只需要直接访问 http://ServiceName:Port 就可以访问到相应的 Service")]),t._v(" "),a("li",[t._v("不同 namespace 下的规则是 [ServiceName].[NameSpace].svc.cluster.local")])])]),t._v(" "),a("li",[t._v("ServiceName 就是我们创建的 Service 名称")]),t._v(" "),a("li",[t._v("NameSpace 则是命名空间。如果你没有命名空间，则这个值为 default。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[this._v("curl http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(":")]),this._v("//service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("v2.default.svc.cluster.local\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"污点与容忍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#污点与容忍","aria-hidden":"true"}},[this._v("#")]),this._v(" 污点与容忍")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("在 "),a("code",[t._v("Kubernetes")]),t._v(" 中， Pod 被部署到 Node 上面去的规则和逻辑是由 "),a("code",[t._v("Kubernetes")]),t._v(" 的调度组件根据 Node 的剩余资源，地位，以及其他规则自动选择调度的。但是有时候在设计架构时，前端和后端往往服务器资源的分配都是不均衡的，甚至有的服务只能让特定的服务器来跑。")]),t._v(" "),a("li",[t._v("在这种情况下，我们选择自动调度是不均衡的，就需要人工去干预匹配选择规则了。这时候，就需要在给 Node 添加一个叫做污点的东西，以确保 Node 不被 Pod 调度到。")]),t._v(" "),a("li",[t._v("当你给 Node 设置一个污点后，除非给 Pod 设置一个相对应的容忍度，否则 Pod 才能被调度上去。这也就是污点和容忍的来源。")]),t._v(" "),a("li",[t._v("污点的格式是 "),a("code",[t._v("key=value")]),t._v("，可以自定义自己的内容，就像是一组 "),a("code",[t._v("Tag")]),t._v(" 一样。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"给-node-设置污点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#给-node-设置污点","aria-hidden":"true"}},[this._v("#")]),this._v(" 给 Node 设置污点")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("其中，Node_Name 为要添加污点的 node 名称；key 和 value 为一组键值对，代表一组标示标签；NoSchedule 则为不被调度的意思，和它同级别的还有其他的值：PreferNoSchedule 和 NoExecute （后面我们会写到）")]),this._v(" "),s("li",[this._v("删除pod 重启pod \b会发现 node2没有被分配到")]),this._v(" "),s("li",[this._v("Pod 被调度到了 Node1 上面去。因为 Node2 添加了污点，不会被调度到 Node2 上面去。此时污点生效。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubectl taint nodes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Node_Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NoSchedule\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# demo")]),t._v("\nkubectl taint nodes node2 nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2=true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NoSchedule\n\nkubectl delete pod "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("POD_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nkubectl describe pod "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("POD_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"给-pod-设置容忍度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#给-pod-设置容忍度","aria-hidden":"true"}},[this._v("#")]),this._v(" 给 Pod 设置容忍度")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("可以看到，给 Node 添加完污点后，新创建的 "),a("code",[t._v("Pod")]),t._v(" 都不会调度到添加了污点的 "),a("code",[t._v("Node")]),t._v(" 上面。所以我们想让 "),a("code",[t._v("Pod")]),t._v(" 被调度过去，需要在 Pod 一侧添加相同的容忍度才能被调度到。")]),t._v(" "),a("li",[t._v("我们编辑 "),a("code",[t._v("deployment")]),t._v(" 配置文件，在 "),a("code",[t._v("template.spec")]),t._v(" 下添加以下字段：")]),t._v(" "),a("li",[t._v("字段的含义是在给 "),a("code",[t._v("Pod")]),t._v(" 设置一组容忍度，以匹配对应的 "),a("code",[t._v("Node")]),t._v(" 的污点。 "),a("code",[t._v("key")]),t._v(" 和 "),a("code",[t._v("value")]),t._v(" 是你配置 "),a("code",[t._v("Node")]),t._v(" 污点的 "),a("code",[t._v("key")]),t._v(" 和 "),a("code",[t._v("value；")]),t._v(" "),a("code",[t._v("effect")]),t._v(" 是 "),a("code",[t._v("Node")]),t._v(" 污点的调度效果，和 "),a("code",[t._v("Node")]),t._v(" 的设置项也是匹配的。")]),t._v(" "),a("li",[a("code",[t._v("operator")]),t._v(" 是运算符，"),a("code",[t._v("equal")]),t._v(" 代表只有 "),a("code",[t._v("key")]),t._v(" 和 "),a("code",[t._v("value")]),t._v(" 相等才算数。当然也可以配置 "),a("code",[t._v("exists")]),t._v(" ，代表只要 "),a("code",[t._v("key")]),t._v(" 存在就匹配，不需要校验 "),a("code",[t._v("value")]),t._v(" 的值")]),t._v(" "),a("li",[t._v("修改保存后，我们使用 "),a("code",[t._v("kubectl apply -f")]),t._v(" 命令让配置项生效，接着删除已存在的 "),a("code",[t._v("Pod")]),t._v("，查看下新"),a("code",[t._v("Pod")]),t._v("的调度结果：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"YOUR KEY"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Equal"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"VALUE"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NoSchedule"')]),t._v("\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源类型")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2     ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#资源名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#告诉deployment根据规则匹配相应的Pod进行控制和管理，matchLabels字段匹配Pod的label值")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#声明一个 Pod,副本的数量")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Pod的名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#组内创建的 Pod 信息")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx-2"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Equal"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NoSchedule"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器的名称")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" songge/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dome2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用哪个镜像")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80 ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器内映射的端口")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"修改-删除-node-的污点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改-删除-node-的污点","aria-hidden":"true"}},[this._v("#")]),this._v(" 修改/删除 Node 的污点")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("修改污点的方式也很简单，像创建一个污点一样，我们依然使用 "),s("code",[this._v("kubectl taint")]),this._v(" 命令就可以完成修改：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubectl taint nodes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Node_Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NoSchedule "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("overwrite\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("这里的 key 依然是要修改的 key 值，只需要对 value 和作用的值进行修改即可。后面添加参数 --overwrite 代表覆盖之前的数据。")]),this._v(" "),s("li",[this._v("删除污点也依然很简单。我们只需要加个 - 号就可以删除污点：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("kubectl taint nodes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Node_Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("kubectl create secret docker-registry private-registry "),s("br"),this._v("\n--docker-username=[admin] "),s("br"),this._v("\n--docker-password=[Sg920322] "),s("br"),this._v("\n--docker-email=[5017098525@qq.com] "),s("br"),this._v("\n--docker-server=[106.15.106.83:8081]")])}],!1,null,null,null);s.default=n.exports}}]);