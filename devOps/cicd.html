<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>cicd | NorthUnicorn</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.9854472c.css" as="style"><link rel="preload" href="/assets/js/app.188d2b4b.js" as="script"><link rel="preload" href="/assets/js/44.e4b90d65.js" as="script"><link rel="prefetch" href="/assets/js/10.78f49902.js"><link rel="prefetch" href="/assets/js/11.54a6664f.js"><link rel="prefetch" href="/assets/js/12.fb7436a2.js"><link rel="prefetch" href="/assets/js/13.88a9f8ba.js"><link rel="prefetch" href="/assets/js/14.c854726e.js"><link rel="prefetch" href="/assets/js/15.41da25a8.js"><link rel="prefetch" href="/assets/js/16.93613165.js"><link rel="prefetch" href="/assets/js/17.77c8c8f4.js"><link rel="prefetch" href="/assets/js/18.fb67ca7b.js"><link rel="prefetch" href="/assets/js/19.b16febc7.js"><link rel="prefetch" href="/assets/js/2.d8f505d4.js"><link rel="prefetch" href="/assets/js/20.865d4ba1.js"><link rel="prefetch" href="/assets/js/21.8fbca06b.js"><link rel="prefetch" href="/assets/js/22.1f7d1a22.js"><link rel="prefetch" href="/assets/js/23.a41ee23e.js"><link rel="prefetch" href="/assets/js/24.1b9dbaa8.js"><link rel="prefetch" href="/assets/js/25.96a87374.js"><link rel="prefetch" href="/assets/js/26.d7f87ea9.js"><link rel="prefetch" href="/assets/js/27.938cea29.js"><link rel="prefetch" href="/assets/js/28.22d5a464.js"><link rel="prefetch" href="/assets/js/29.f1258146.js"><link rel="prefetch" href="/assets/js/3.8796f9d7.js"><link rel="prefetch" href="/assets/js/30.555391dd.js"><link rel="prefetch" href="/assets/js/31.1c089743.js"><link rel="prefetch" href="/assets/js/32.f1710f84.js"><link rel="prefetch" href="/assets/js/33.3a44c355.js"><link rel="prefetch" href="/assets/js/34.89fc76ca.js"><link rel="prefetch" href="/assets/js/35.ae5ec0f1.js"><link rel="prefetch" href="/assets/js/36.14636755.js"><link rel="prefetch" href="/assets/js/37.85c35c6f.js"><link rel="prefetch" href="/assets/js/38.4b97d4eb.js"><link rel="prefetch" href="/assets/js/39.c4574241.js"><link rel="prefetch" href="/assets/js/4.c59777f9.js"><link rel="prefetch" href="/assets/js/40.2ae0ff3f.js"><link rel="prefetch" href="/assets/js/41.f55ba23e.js"><link rel="prefetch" href="/assets/js/42.5f71b867.js"><link rel="prefetch" href="/assets/js/43.d4963081.js"><link rel="prefetch" href="/assets/js/45.3b76131f.js"><link rel="prefetch" href="/assets/js/46.cb50381c.js"><link rel="prefetch" href="/assets/js/47.5b0c84f7.js"><link rel="prefetch" href="/assets/js/48.9c8ec2da.js"><link rel="prefetch" href="/assets/js/49.b989cb8f.js"><link rel="prefetch" href="/assets/js/5.9b395665.js"><link rel="prefetch" href="/assets/js/50.15af8405.js"><link rel="prefetch" href="/assets/js/51.edf352ef.js"><link rel="prefetch" href="/assets/js/52.3f1d14aa.js"><link rel="prefetch" href="/assets/js/53.63d16719.js"><link rel="prefetch" href="/assets/js/54.3de95c8f.js"><link rel="prefetch" href="/assets/js/55.440b64a4.js"><link rel="prefetch" href="/assets/js/56.b33a70aa.js"><link rel="prefetch" href="/assets/js/57.e710eecf.js"><link rel="prefetch" href="/assets/js/58.34d8338e.js"><link rel="prefetch" href="/assets/js/59.a4decd93.js"><link rel="prefetch" href="/assets/js/6.d5fd31a3.js"><link rel="prefetch" href="/assets/js/60.aa97eba7.js"><link rel="prefetch" href="/assets/js/61.a5c54723.js"><link rel="prefetch" href="/assets/js/62.98a91609.js"><link rel="prefetch" href="/assets/js/63.b523c85f.js"><link rel="prefetch" href="/assets/js/64.a9d9854e.js"><link rel="prefetch" href="/assets/js/65.247a1c65.js"><link rel="prefetch" href="/assets/js/66.86ef78b9.js"><link rel="prefetch" href="/assets/js/67.9fca9287.js"><link rel="prefetch" href="/assets/js/68.b4e9bc19.js"><link rel="prefetch" href="/assets/js/69.d6d04419.js"><link rel="prefetch" href="/assets/js/7.7cd0770b.js"><link rel="prefetch" href="/assets/js/70.d821cfe7.js"><link rel="prefetch" href="/assets/js/71.f88b33a3.js"><link rel="prefetch" href="/assets/js/72.61ea1e83.js"><link rel="prefetch" href="/assets/js/73.4c9a3e37.js"><link rel="prefetch" href="/assets/js/74.66313cc3.js"><link rel="prefetch" href="/assets/js/75.61024e27.js"><link rel="prefetch" href="/assets/js/76.f17fb6b7.js"><link rel="prefetch" href="/assets/js/77.bd651836.js"><link rel="prefetch" href="/assets/js/78.ac3ca5d4.js"><link rel="prefetch" href="/assets/js/79.5a92618c.js"><link rel="prefetch" href="/assets/js/8.2e118734.js"><link rel="prefetch" href="/assets/js/80.414890e8.js"><link rel="prefetch" href="/assets/js/81.00bfaa8c.js"><link rel="prefetch" href="/assets/js/82.80baaa77.js"><link rel="prefetch" href="/assets/js/83.e6b36923.js"><link rel="prefetch" href="/assets/js/84.5b32acfb.js"><link rel="prefetch" href="/assets/js/85.d79e7154.js"><link rel="prefetch" href="/assets/js/86.953d31b7.js"><link rel="prefetch" href="/assets/js/87.fdf14da0.js"><link rel="prefetch" href="/assets/js/88.0009f29c.js"><link rel="prefetch" href="/assets/js/89.bea5b9ea.js"><link rel="prefetch" href="/assets/js/9.43ae41b6.js"><link rel="prefetch" href="/assets/js/90.dcc0245d.js"><link rel="prefetch" href="/assets/js/91.e51769d3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9854472c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NorthUnicorn</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front/" class="nav-link">front</a></div><div class="nav-item"><a href="/houduan/" class="nav-link">back</a></div><div class="nav-item"><a href="/devOps/" class="nav-link router-link-active">devOps</a></div><div class="nav-item"><a href="/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/article/" class="nav-link">article</a></div><div class="nav-item"><a href="/northui/" class="nav-link">northui</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">about</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front/" class="nav-link">front</a></div><div class="nav-item"><a href="/houduan/" class="nav-link">back</a></div><div class="nav-item"><a href="/devOps/" class="nav-link router-link-active">devOps</a></div><div class="nav-item"><a href="/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/article/" class="nav-link">article</a></div><div class="nav-item"><a href="/northui/" class="nav-link">northui</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">about</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>devOps</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/devOps/git.html" class="sidebar-link">git</a></li><li><a href="/devOps/nginx.html" class="sidebar-link">nginx</a></li><li><a href="/devOps/linux.html" class="sidebar-link">linux</a></li><li><a href="/devOps/docker.html" class="sidebar-link">docker</a></li><li><a href="/devOps/jenkins.html" class="sidebar-link">jenkins</a></li><li><a href="/devOps/vscode.html" class="sidebar-link">vscode</a></li><li><a href="/devOps/jest.html" class="sidebar-link">jest base</a></li><li><a href="/devOps/k8s.html" class="sidebar-link">Kubernetes</a></li><li><a href="/devOps/cicd.html" class="active sidebar-link">cicd</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devOps/cicd.html#安装git" class="sidebar-link">安装git</a></li><li class="sidebar-sub-header"><a href="/devOps/cicd.html#安装-jenkins" class="sidebar-link">安装 Jenkins</a></li><li class="sidebar-sub-header"><a href="/devOps/cicd.html#安装nodejs" class="sidebar-link">安装Nodejs</a></li><li class="sidebar-sub-header"><a href="/devOps/cicd.html#jenkins-测试第一个dome" class="sidebar-link">Jenkins 测试第一个dome</a></li><li class="sidebar-sub-header"><a href="/devOps/cicd.html#镜像库" class="sidebar-link">镜像库</a></li><li class="sidebar-sub-header"><a href="/devOps/cicd.html#启动-nexus" class="sidebar-link">启动 Nexus</a></li><li class="sidebar-sub-header"><a href="/devOps/cicd.html#配置-nexus" class="sidebar-link">配置 Nexus</a></li><li class="sidebar-sub-header"><a href="/devOps/cicd.html#利用-jenkins推送镜像到制品库" class="sidebar-link">利用 Jenkins推送镜像到制品库</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="cicd"><a href="#cicd" aria-hidden="true" class="header-anchor">#</a> cicd</h1> <h2 id="安装git"><a href="#安装git" aria-hidden="true" class="header-anchor">#</a> 安装git</h2> <div class="language-yaml extra-class"><pre class="language-yaml"><code>yum install git <span class="token punctuation">-</span>y
</code></pre></div><h2 id="安装-jenkins"><a href="#安装-jenkins" aria-hidden="true" class="header-anchor">#</a> 安装 Jenkins</h2> <h3 id="安装java"><a href="#安装java" aria-hidden="true" class="header-anchor">#</a> 安装java</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code>yum install <span class="token punctuation">-</span>y java
</code></pre></div><h3 id="安装jenkins"><a href="#安装jenkins" aria-hidden="true" class="header-anchor">#</a> 安装jenkins</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code>sudo wget <span class="token punctuation">-</span>O /etc/yum.repos.d/jenkins.repo https<span class="token punctuation">:</span>//img.zhufengpeixun.com/jenkins.repo
sudo rpm <span class="token punctuation">-</span><span class="token punctuation">-</span>import https<span class="token punctuation">:</span>//img.zhufengpeixun.com/jenkins.io.key
yum install jenkins <span class="token punctuation">-</span>y
</code></pre></div><h3 id="启动-jenkins"><a href="#启动-jenkins" aria-hidden="true" class="header-anchor">#</a> 启动 Jenkins</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code>systemctl start jenkins.service
</code></pre></div><ul><li>开放端口</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>firewall<span class="token punctuation">-</span>cmd <span class="token punctuation">-</span><span class="token punctuation">-</span>zone=public <span class="token punctuation">-</span><span class="token punctuation">-</span>add<span class="token punctuation">-</span>port=8080/tcp <span class="token punctuation">-</span><span class="token punctuation">-</span>permanent
firewall<span class="token punctuation">-</span>cmd <span class="token punctuation">-</span><span class="token punctuation">-</span>zone=public <span class="token punctuation">-</span><span class="token punctuation">-</span>add<span class="token punctuation">-</span>port=50000/tcp <span class="token punctuation">-</span><span class="token punctuation">-</span>permanent
systemctl reload firewalld
</code></pre></div><ul><li>打开浏览器访问</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>http<span class="token punctuation">:</span>//ip<span class="token punctuation">:</span>8080/
</code></pre></div><ul><li>查看密码</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>cat /var/lib/jenkins/secrets/initialAdminPassword
</code></pre></div><ul><li>修改插件镜像</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>sed <span class="token punctuation">-</span>i 's/http<span class="token punctuation">:</span>\/\/updates.jenkins<span class="token punctuation">-</span>ci.org\/download/https<span class="token punctuation">:</span>\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g' /var/lib/jenkins/updates/default.json &amp;&amp; sed <span class="token punctuation">-</span>i 's/http<span class="token punctuation">:</span>\/\/www.google.com/https<span class="token punctuation">:</span>\/\/www.baidu.com/g' /var/lib/jenkins/updates/default.json
</code></pre></div><ul><li>添加到docker用户组里</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>sudo gpasswd <span class="token punctuation">-</span>a jenkins docker  <span class="token comment">#将当前用户添加至docker用户组</span>
newgrp docker                 <span class="token comment">#更新docker用户组</span>

sudo service jenkins restart <span class="token comment"># 重启</span>
</code></pre></div><h3 id="新建任务"><a href="#新建任务" aria-hidden="true" class="header-anchor">#</a> 新建任务</h3> <ul><li>新建任务=&gt;构建一个自由风格的软件项目=&gt;配置&gt;增加构建步骤</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>docker <span class="token punctuation">-</span>v
docker pull node<span class="token punctuation">:</span>latest
</code></pre></div><ul><li>再次执行脚本。此时执行成功</li></ul> <h2 id="安装nodejs"><a href="#安装nodejs" aria-hidden="true" class="header-anchor">#</a> 安装Nodejs</h2> <ul><li>系统管理 =&gt; 插件管理 =&gt; 可选插件 =》 安装NodeJS插件</li> <li>系统管理 =&gt; 全局工具配置 =&gt; NodeJS =&gt; 新增NodeJS</li> <li>任务的配置=&gt;构建环境=&gt;选中 Provide Node &amp; npm bin/ folder to PATH</li></ul> <h2 id="jenkins-测试第一个dome"><a href="#jenkins-测试第一个dome" aria-hidden="true" class="header-anchor">#</a> Jenkins 测试第一个dome</h2> <h3 id="git-仓库-保存一份代码"><a href="#git-仓库-保存一份代码" aria-hidden="true" class="header-anchor">#</a> git 仓库 保存一份代码</h3> <ul><li>/build/index.html</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>&lt;<span class="token tag">!DOCTYPE</span> html<span class="token punctuation">&gt;</span>
&lt;html lang=&quot;en&quot;<span class="token punctuation">&gt;</span>
&lt;head<span class="token punctuation">&gt;</span>
    &lt;meta charset=&quot;UTF<span class="token punctuation">-</span>8&quot;<span class="token punctuation">&gt;</span>
    &lt;meta http<span class="token punctuation">-</span>equiv=&quot;X<span class="token punctuation">-</span>UA<span class="token punctuation">-</span>Compatible&quot; content=&quot;IE=edge&quot;<span class="token punctuation">&gt;</span>
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device<span class="token punctuation">-</span>width<span class="token punctuation">,</span> initial<span class="token punctuation">-</span>scale=1.0&quot;<span class="token punctuation">&gt;</span>
    &lt;title<span class="token punctuation">&gt;</span>Document&lt;/title<span class="token punctuation">&gt;</span>
&lt;/head<span class="token punctuation">&gt;</span>
&lt;body<span class="token punctuation">&gt;</span>
    1111
&lt;/body<span class="token punctuation">&gt;</span>
&lt;/html<span class="token punctuation">&gt;</span>
</code></pre></div><ul><li>conf/nginx.conf</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>events<span class="token punctuation">{</span>
	worker_connections 1024;
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    server <span class="token punctuation">{</span>
        listen       80;
        listen       <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
        server_name  _;
        root         /etc/nginx/html;
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Dockerfile</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>FROM nginx<span class="token punctuation">:</span><span class="token number">1.15</span>
COPY build /etc/nginx/html
COPY conf /etc/nginx/
WORKDIR /etc/nginx/html
</code></pre></div><h3 id="jenkins-配置私钥"><a href="#jenkins-配置私钥" aria-hidden="true" class="header-anchor">#</a> Jenkins 配置私钥</h3> <ul><li>我们可以在配置任务时，来添加一个自己的凭证。点击项目的 配置，依次找到 源码管理 =&gt; Git =&gt; Repositories
<ul><li>Repository URL, 地址格式为 <code>git@gitee.com:xxx/xxx.git</code>,(可以将上面的保存代码的地址复制过来)</li></ul></li> <li>重点是 Credentials 这一项，这里则是我们选择认证凭证的地方。我们可以点击右侧 添加 =&gt; Jenkins 按钮添加一条新的凭证认证信息。</li> <li>点击后会打开一个弹窗，这是 Jenkins 添加凭证的弹窗。选择类型中的 SSH Username with private key 这一项。接着填写信息即可：
<ul><li>D：这条认证凭证在 Jenkins 中的名称是什么</li> <li>描述：描述信息</li> <li>Username：用户名（邮箱）</li> <li>Private Key：这里则是我们填写私钥的地方。点击 Add 按钮，将 xxx 私钥文件内所有文件内容全部复制过去（包含开头的 BEGIN OPENSSH PRIVATE KEY 和结尾的 END OPENSSH PRIVATE KEY）</li> <li>私钥 ~/.ssh/id_rsa`</li> <li>如果没有出现红色无权限提示，则代表身份校验成功，可以正常访问。</li></ul></li></ul> <h3 id="构建镜像"><a href="#构建镜像" aria-hidden="true" class="header-anchor">#</a> 构建镜像</h3> <ul><li>构建 =&gt; Execute shell。输入以下脚本：</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#!/bin/sh -l</span>
docker build <span class="token punctuation">-</span>t test .
docker run <span class="token punctuation">-</span>p 8888<span class="token punctuation">:</span>80 test
</code></pre></div><ul><li>在如果构建成功 在服务里可以看到这个镜像,同时容器运行成功</li></ul> <h2 id="镜像库"><a href="#镜像库" aria-hidden="true" class="header-anchor">#</a> 镜像库</h2> <ul><li>部署 Nexus 服务</li> <li>在部署 Nexus 之前，需要先下载 Nexus 的安装包（这里需要另外找个托管服务）</li> <li>解压后，我们可以看到有2个文件夹。分别是 nexus-3.29.0-02 和 sonatype-work 。其中，nexus-3.29.0-02 是nexus主程序文件夹，sonatype-work 则是数据文件。</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>wget https<span class="token punctuation">:</span>//dependency<span class="token punctuation">-</span>fe.oss<span class="token punctuation">-</span>cn<span class="token punctuation">-</span>beijing.aliyuncs.com/nexus<span class="token punctuation">-</span>3.29.0<span class="token punctuation">-</span>02<span class="token punctuation">-</span>unix.tar.gz

tar <span class="token punctuation">-</span>zxvf ./nexus<span class="token punctuation">-</span>3.29.0<span class="token punctuation">-</span>02<span class="token punctuation">-</span>unix.tar.gz
</code></pre></div><h2 id="启动-nexus"><a href="#启动-nexus" aria-hidden="true" class="header-anchor">#</a> 启动 Nexus</h2> <ul><li>我们进入 nexus-3.29.0-02 下面的 bin 目录，这里就是 nexus 的主命令目录。我们在 bin 目录下，执行 ./nexus start 命令即可启动 nexus ：</li> <li>nexus 还支持停止，重启等命令。可以在 bin 目录下执行 ./nexus help 查看更多命令</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>./nexus start
</code></pre></div><ul><li>由于 nexus 默认服务端口是 8081，稍后我们还需要给镜像库访问单独开放一个 8082 端口。这里将 8081，8082 端口添加到防火墙放行规则内（没开防火墙则可以略过）：</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>firewall<span class="token punctuation">-</span>cmd <span class="token punctuation">-</span><span class="token punctuation">-</span>zone=public <span class="token punctuation">-</span><span class="token punctuation">-</span>add<span class="token punctuation">-</span>port=8081/tcp <span class="token punctuation">-</span><span class="token punctuation">-</span>permanent
firewall<span class="token punctuation">-</span>cmd <span class="token punctuation">-</span><span class="token punctuation">-</span>zone=public <span class="token punctuation">-</span><span class="token punctuation">-</span>add<span class="token punctuation">-</span>port=8082/tcp <span class="token punctuation">-</span><span class="token punctuation">-</span>permanent
</code></pre></div><ul><li>打开浏览器地址栏，访问 IP:8081 。启动时间比较长，需要耐心等待。在 Nexus 启动后，会进入这个欢迎页面：</li></ul> <h2 id="配置-nexus"><a href="#配置-nexus" aria-hidden="true" class="header-anchor">#</a> 配置 Nexus</h2> <ul><li>进入欢迎页后，点击右上角的登录，会打开登录框。这里需要我们输入 默认管理员密码 进行初始化配置。</li> <li>可以在这里找到：</li> <li>将文件中获取到的密码输入进去，登录用户名是 admin 。</li> <li>注意请立即更改密码</li> <li>Enable anonymous access</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># 注意  /root/这个是安装的目录  根据自己的情况</span>
cat /root/sonatype<span class="token punctuation">-</span>work/nexus3/admin.password 
</code></pre></div><h3 id="创建docker私服"><a href="#创建docker私服" aria-hidden="true" class="header-anchor">#</a> 创建Docker私服</h3> <ul><li>登录 =&gt; 齿轮图标 =&gt; Repositories =&gt; Create repository =&gt; docker(hosted) =&gt; HTTP(8082)</li> <li>proxy: 此类型制品库原则上只下载，不允许用户推送</li> <li>hosted：此类型制品库和 proxy 相反，原则上 只允许用户推送，不允许缓存。这里只存放自己的私有镜像或制品</li> <li>group：此类型制品库可以将以上两种类型的制品库组合起来</li></ul> <h3 id="添加访问权限"><a href="#添加访问权限" aria-hidden="true" class="header-anchor">#</a> 添加访问权限</h3> <ul><li>齿轮图标 =&gt; Realms =&gt; Docker Bearer Token Realm =&gt; 添加到右边的 Active =&gt;保存</li> <li>copy http://106.15.106.83:8081/repository/study/</li></ul> <h3 id="登录制品库"><a href="#登录制品库" aria-hidden="true" class="header-anchor">#</a> 登录制品库</h3> <ul><li>如果有这个报错 需要配置下面内容</li> <li><code>Failed to pull image &quot;106.15.106.83:8082/frontend-app:20210927153747&quot;: rpc error: code = Unknown desc = Error response from daemon: Get &quot;https://106.15.106.83:8082/v2/&quot;: http: server gave HTTP response to HTTPS client</code></li> <li>vi /etc/docker/daemon.json</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">{</span>
  <span class="token key atrule">&quot;insecure-registries&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;106.15.106.83:8082&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token key atrule">&quot;registry-mirrors&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://fwvjnv59.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>



106.15.106.83<span class="token punctuation">:</span>8082/test

<span class="token comment"># master</span>
47.100.74.198<span class="token punctuation">:</span><span class="token number">49154</span>


private<span class="token punctuation">-</span>registry

regcred



<span class="token comment"># 重载所有修改过的配置文件</span>
sudo systemctl daemon<span class="token punctuation">-</span>reload
sudo systemctl restart docker
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code>systemctl restart docker
docker login 106.15.106.83<span class="token punctuation">:</span>8082 //注意此处要和insecure<span class="token punctuation">-</span>registries里的地址一致
<span class="token key atrule">Username</span><span class="token punctuation">:</span> admin
<span class="token key atrule">Password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
</code></pre></div><ul><li>如果这个报错 <code>no basic auth credentials</code></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># 配置私有的 建议这个</span>
kubectl create secret docker<span class="token punctuation">-</span>registry private<span class="token punctuation">-</span>registry \
<span class="token punctuation">-</span><span class="token punctuation">-</span>docker<span class="token punctuation">-</span>username=admin \
<span class="token punctuation">-</span><span class="token punctuation">-</span>docker<span class="token punctuation">-</span>password=Sg920322 \
<span class="token punctuation">-</span><span class="token punctuation">-</span>docker<span class="token punctuation">-</span>email=501798525@qq.com \
<span class="token punctuation">-</span><span class="token punctuation">-</span>docker<span class="token punctuation">-</span>server=106.15.106.83<span class="token punctuation">:</span><span class="token number">8082</span>

<span class="token comment"># 或者直接拿取docker配置</span>
kubectl create secret generic regcred  <span class="token punctuation">-</span><span class="token punctuation">-</span>from<span class="token punctuation">-</span>file=.dockerconfigjson=/root/.docker/config.json <span class="token punctuation">-</span><span class="token punctuation">-</span>type=kubernetes.io/dockerconfigjson
</code></pre></div><h2 id="利用-jenkins推送镜像到制品库"><a href="#利用-jenkins推送镜像到制品库" aria-hidden="true" class="header-anchor">#</a> 利用 Jenkins推送镜像到制品库</h2> <h3 id="利用凭据给-shell-注入镜像库用户名密码"><a href="#利用凭据给-shell-注入镜像库用户名密码" aria-hidden="true" class="header-anchor">#</a> 利用凭据给 Shell 注入镜像库用户名密码</h3> <ul><li>设置界面 =&gt; 构建环境 =&gt; 勾选 Use secret text(s) or file(s) =&gt; 新增选择 =&gt; Username and password (separated)
<ul><li>DOCKER_LOGIN_USERNAME</li> <li>DOCKER_LOGIN_PASSWORD</li></ul></li> <li>接着在下面指定凭据=&gt;添加jenkins=&gt;选择类型Username with password,输入用户名和密码然后点添加确定,这里的账号<code>admin</code>对应<code>DOCKER_LOGIN_USERNAME</code>, <code>DOCKER_LOGIN_PASSWORD</code>对应输入密码<code>123456</code></li> <li>修改 shell 执行</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#!/bin/sh -l</span>
docker build <span class="token punctuation">-</span>t 106.15.106.83<span class="token punctuation">:</span>8082/test .
docker login <span class="token punctuation">-</span>u $DOCKER_LOGIN_USERNAME <span class="token punctuation">-</span>p $DOCKER_LOGIN_PASSWORD 106.15.106.83<span class="token punctuation">:</span><span class="token number">8082</span>
docker push 106.15.106.83<span class="token punctuation">:</span>8082/test
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">10/1/2021, 2:45:02 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/devOps/k8s.html" class="prev">
          Kubernetes
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.188d2b4b.js" defer></script><script src="/assets/js/44.e4b90d65.js" defer></script>
  </body>
</html>
