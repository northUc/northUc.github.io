<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>jenkins | NorthUnicorn</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.9854472c.css" as="style"><link rel="preload" href="/assets/js/app.188d2b4b.js" as="script"><link rel="preload" href="/assets/js/47.5b0c84f7.js" as="script"><link rel="prefetch" href="/assets/js/10.78f49902.js"><link rel="prefetch" href="/assets/js/11.54a6664f.js"><link rel="prefetch" href="/assets/js/12.fb7436a2.js"><link rel="prefetch" href="/assets/js/13.88a9f8ba.js"><link rel="prefetch" href="/assets/js/14.c854726e.js"><link rel="prefetch" href="/assets/js/15.41da25a8.js"><link rel="prefetch" href="/assets/js/16.93613165.js"><link rel="prefetch" href="/assets/js/17.77c8c8f4.js"><link rel="prefetch" href="/assets/js/18.fb67ca7b.js"><link rel="prefetch" href="/assets/js/19.b16febc7.js"><link rel="prefetch" href="/assets/js/2.d8f505d4.js"><link rel="prefetch" href="/assets/js/20.865d4ba1.js"><link rel="prefetch" href="/assets/js/21.8fbca06b.js"><link rel="prefetch" href="/assets/js/22.1f7d1a22.js"><link rel="prefetch" href="/assets/js/23.a41ee23e.js"><link rel="prefetch" href="/assets/js/24.1b9dbaa8.js"><link rel="prefetch" href="/assets/js/25.96a87374.js"><link rel="prefetch" href="/assets/js/26.d7f87ea9.js"><link rel="prefetch" href="/assets/js/27.938cea29.js"><link rel="prefetch" href="/assets/js/28.22d5a464.js"><link rel="prefetch" href="/assets/js/29.f1258146.js"><link rel="prefetch" href="/assets/js/3.8796f9d7.js"><link rel="prefetch" href="/assets/js/30.555391dd.js"><link rel="prefetch" href="/assets/js/31.1c089743.js"><link rel="prefetch" href="/assets/js/32.f1710f84.js"><link rel="prefetch" href="/assets/js/33.3a44c355.js"><link rel="prefetch" href="/assets/js/34.89fc76ca.js"><link rel="prefetch" href="/assets/js/35.ae5ec0f1.js"><link rel="prefetch" href="/assets/js/36.14636755.js"><link rel="prefetch" href="/assets/js/37.85c35c6f.js"><link rel="prefetch" href="/assets/js/38.4b97d4eb.js"><link rel="prefetch" href="/assets/js/39.c4574241.js"><link rel="prefetch" href="/assets/js/4.c59777f9.js"><link rel="prefetch" href="/assets/js/40.2ae0ff3f.js"><link rel="prefetch" href="/assets/js/41.f55ba23e.js"><link rel="prefetch" href="/assets/js/42.5f71b867.js"><link rel="prefetch" href="/assets/js/43.d4963081.js"><link rel="prefetch" href="/assets/js/44.e4b90d65.js"><link rel="prefetch" href="/assets/js/45.3b76131f.js"><link rel="prefetch" href="/assets/js/46.cb50381c.js"><link rel="prefetch" href="/assets/js/48.9c8ec2da.js"><link rel="prefetch" href="/assets/js/49.b989cb8f.js"><link rel="prefetch" href="/assets/js/5.9b395665.js"><link rel="prefetch" href="/assets/js/50.15af8405.js"><link rel="prefetch" href="/assets/js/51.edf352ef.js"><link rel="prefetch" href="/assets/js/52.3f1d14aa.js"><link rel="prefetch" href="/assets/js/53.63d16719.js"><link rel="prefetch" href="/assets/js/54.3de95c8f.js"><link rel="prefetch" href="/assets/js/55.440b64a4.js"><link rel="prefetch" href="/assets/js/56.b33a70aa.js"><link rel="prefetch" href="/assets/js/57.e710eecf.js"><link rel="prefetch" href="/assets/js/58.34d8338e.js"><link rel="prefetch" href="/assets/js/59.a4decd93.js"><link rel="prefetch" href="/assets/js/6.d5fd31a3.js"><link rel="prefetch" href="/assets/js/60.aa97eba7.js"><link rel="prefetch" href="/assets/js/61.a5c54723.js"><link rel="prefetch" href="/assets/js/62.98a91609.js"><link rel="prefetch" href="/assets/js/63.b523c85f.js"><link rel="prefetch" href="/assets/js/64.a9d9854e.js"><link rel="prefetch" href="/assets/js/65.247a1c65.js"><link rel="prefetch" href="/assets/js/66.86ef78b9.js"><link rel="prefetch" href="/assets/js/67.9fca9287.js"><link rel="prefetch" href="/assets/js/68.b4e9bc19.js"><link rel="prefetch" href="/assets/js/69.d6d04419.js"><link rel="prefetch" href="/assets/js/7.7cd0770b.js"><link rel="prefetch" href="/assets/js/70.d821cfe7.js"><link rel="prefetch" href="/assets/js/71.f88b33a3.js"><link rel="prefetch" href="/assets/js/72.61ea1e83.js"><link rel="prefetch" href="/assets/js/73.4c9a3e37.js"><link rel="prefetch" href="/assets/js/74.66313cc3.js"><link rel="prefetch" href="/assets/js/75.61024e27.js"><link rel="prefetch" href="/assets/js/76.f17fb6b7.js"><link rel="prefetch" href="/assets/js/77.bd651836.js"><link rel="prefetch" href="/assets/js/78.ac3ca5d4.js"><link rel="prefetch" href="/assets/js/79.5a92618c.js"><link rel="prefetch" href="/assets/js/8.2e118734.js"><link rel="prefetch" href="/assets/js/80.414890e8.js"><link rel="prefetch" href="/assets/js/81.00bfaa8c.js"><link rel="prefetch" href="/assets/js/82.80baaa77.js"><link rel="prefetch" href="/assets/js/83.e6b36923.js"><link rel="prefetch" href="/assets/js/84.5b32acfb.js"><link rel="prefetch" href="/assets/js/85.d79e7154.js"><link rel="prefetch" href="/assets/js/86.953d31b7.js"><link rel="prefetch" href="/assets/js/87.fdf14da0.js"><link rel="prefetch" href="/assets/js/88.0009f29c.js"><link rel="prefetch" href="/assets/js/89.bea5b9ea.js"><link rel="prefetch" href="/assets/js/9.43ae41b6.js"><link rel="prefetch" href="/assets/js/90.dcc0245d.js"><link rel="prefetch" href="/assets/js/91.e51769d3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9854472c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NorthUnicorn</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front/" class="nav-link">front</a></div><div class="nav-item"><a href="/houduan/" class="nav-link">back</a></div><div class="nav-item"><a href="/devOps/" class="nav-link router-link-active">devOps</a></div><div class="nav-item"><a href="/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/article/" class="nav-link">article</a></div><div class="nav-item"><a href="/northui/" class="nav-link">northui</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">about</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front/" class="nav-link">front</a></div><div class="nav-item"><a href="/houduan/" class="nav-link">back</a></div><div class="nav-item"><a href="/devOps/" class="nav-link router-link-active">devOps</a></div><div class="nav-item"><a href="/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/article/" class="nav-link">article</a></div><div class="nav-item"><a href="/northui/" class="nav-link">northui</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">about</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>devOps</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/devOps/git.html" class="sidebar-link">git</a></li><li><a href="/devOps/nginx.html" class="sidebar-link">nginx</a></li><li><a href="/devOps/linux.html" class="sidebar-link">linux</a></li><li><a href="/devOps/docker.html" class="sidebar-link">docker</a></li><li><a href="/devOps/jenkins.html" class="active sidebar-link">jenkins</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devOps/jenkins.html#git" class="sidebar-link">git</a></li><li class="sidebar-sub-header"><a href="/devOps/jenkins.html#jenkins-2" class="sidebar-link">Jenkins</a></li><li class="sidebar-sub-header"><a href="/devOps/jenkins.html#jenkins使用" class="sidebar-link">jenkins使用</a></li><li class="sidebar-sub-header"><a href="/devOps/jenkins.html#安装-nodejs-环境" class="sidebar-link">安装 Nodejs 环境</a></li><li class="sidebar-sub-header"><a href="/devOps/jenkins.html#如何使用" class="sidebar-link">如何使用</a></li><li class="sidebar-sub-header"><a href="/devOps/jenkins.html#构建镜像" class="sidebar-link">构建镜像</a></li><li class="sidebar-sub-header"><a href="/devOps/jenkins.html#jenkins-端配置" class="sidebar-link">Jenkins 端配置</a></li></ul></li><li><a href="/devOps/vscode.html" class="sidebar-link">vscode</a></li><li><a href="/devOps/jest.html" class="sidebar-link">jest base</a></li><li><a href="/devOps/k8s.html" class="sidebar-link">Kubernetes</a></li><li><a href="/devOps/cicd.html" class="sidebar-link">cicd</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="jenkins"><a href="#jenkins" aria-hidden="true" class="header-anchor">#</a> jenkins</h1> <h2 id="git"><a href="#git" aria-hidden="true" class="header-anchor">#</a> git</h2> <h3 id="搭建git服务器"><a href="#搭建git服务器" aria-hidden="true" class="header-anchor">#</a> 搭建git服务器</h3> <ul><li>安装git</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>yum install <span class="token operator">-</span>y git
</code></pre></div><ul><li>创建git用户</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>useradd git
passwd git
</code></pre></div><ul><li>创建仓库
<ul><li>git init 会创建一个.git配置文件 提交代码用</li> <li>git init --bare  只会创建一个仓库 让别人提交代码</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>su <span class="token operator">-</span> git
mkdir <span class="token operator">-</span>p <span class="token operator">~</span><span class="token operator">/</span>repos<span class="token operator">/</span>app<span class="token punctuation">.</span>git
cd <span class="token operator">~</span><span class="token operator">/</span>repos<span class="token operator">/</span>app<span class="token punctuation">.</span>git
git <span class="token operator">--</span>bare init
</code></pre></div><h3 id="创建git客户端"><a href="#创建git客户端" aria-hidden="true" class="header-anchor">#</a> 创建git客户端</h3> <div class="language-js extra-class"><pre class="language-js"><code>cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src
<span class="token comment">// clone 刚才创建的 git服务器  </span>
<span class="token comment">// git(是用户名) @后面接服务器的地址 : 后面接git服务器的路径</span>
git clone git@<span class="token number">192.168</span><span class="token number">.20</span><span class="token number">.131</span><span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span>git<span class="token operator">/</span>repos<span class="token operator">/</span>app<span class="token punctuation">.</span>git

<span class="token comment">// 创建文件 提交就可以了</span>
</code></pre></div><ul><li>实现SsH无密码 提交
<ul><li>需要在客户端生成一个公钥
<ul><li>生产公钥</li> <li>ssh-keygen -t rsa</li> <li>在<code>~/.ssh/</code> 目录生成2个密钥 id_rsa 是私钥 id_rsa.pub 是公钥</li> <li>copy 公钥即可</li></ul></li> <li>在服务端，把客户端的公钥添加到authorize_keys文件里
<ul><li>同样在服务器端生成配置文件<code>ssh-keygen -t rsa</code></li> <li>创建一个文件，定时的名字 <code>vi authorized_keys</code></li> <li>将客户端的公钥粘贴进去就可以了</li></ul></li></ul></li></ul> <h2 id="jenkins-2"><a href="#jenkins-2" aria-hidden="true" class="header-anchor">#</a> Jenkins</h2> <h3 id="安装java"><a href="#安装java" aria-hidden="true" class="header-anchor">#</a> 安装java</h3> <ul><li>安装JDK</li></ul> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">// 下载包</span>
wget http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>img<span class="token punctuation">.</span>zhufengpeixun<span class="token punctuation">.</span>cn<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_211<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
<span class="token comment">// 解压包 x解压 z原来是一个gz的包 v显示解压的过程 f指定文件名</span>
tar <span class="token operator">-</span>xzvf jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_211<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz 
<span class="token comment">// 将解压的文件 cp 走</span>
cp <span class="token operator">-</span>r jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_211 <span class="token operator">/</span>usr<span class="token operator">/</span>java
<span class="token comment">// java的执行文件</span>
<span class="token operator">/</span>use<span class="token operator">/</span>java<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_211<span class="token operator">/</span>bin<span class="token operator">/</span>java
<span class="token comment">// 执行查看版本</span>
<span class="token operator">/</span>use<span class="token operator">/</span>java<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_211<span class="token operator">/</span>bin<span class="token operator">/</span>java <span class="token operator">-</span>version 

<span class="token comment">// 将java执行文件 链接到一个文件 /usr/bin/java 就指代java执行文件</span>
ln <span class="token operator">-</span>s <span class="token operator">/</span>use<span class="token operator">/</span>java<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_211<span class="token operator">/</span>bin<span class="token operator">/</span>java <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>java

<span class="token comment">// 配置环境变量  java 就可以在全局访问到了</span>
vi <span class="token operator">/</span>etc<span class="token operator">/</span>profile
<span class="token comment">// 在文件最后加入 下面的 路径根据自己的情况</span>
<span class="token constant">JAVA_HOME</span><span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>java<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0</span>_211
<span class="token keyword">export</span> <span class="token constant">CLASSPATH</span><span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>jre<span class="token operator">/</span>lib<span class="token operator">/</span>rt<span class="token punctuation">.</span>jar<span class="token punctuation">:</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>lib<span class="token operator">/</span>dt<span class="token punctuation">.</span>jar<span class="token punctuation">:</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>lib<span class="token operator">/</span>tools<span class="token punctuation">.</span>jar
<span class="token keyword">export</span> <span class="token constant">PATH</span><span class="token operator">=</span>$<span class="token constant">PATH</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>bin

<span class="token comment">// 使刚才的配置文件生效</span>
source <span class="token operator">/</span>etc<span class="token operator">/</span>profile

<span class="token comment">// 这样全局就可以使用 java了</span>
java <span class="token operator">-</span>version
</code></pre></div><h3 id="安装jenkins"><a href="#安装jenkins" aria-hidden="true" class="header-anchor">#</a> 安装jenkins</h3> <p><a href="https://pkg.jenkins.io/redhat-stable/" target="_blank" rel="noopener noreferrer">下载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1</span>
sudo wget <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>jenkins<span class="token punctuation">.</span>repo https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>pkg<span class="token punctuation">.</span>jenkins<span class="token punctuation">.</span>io<span class="token operator">/</span>redhat<span class="token operator">-</span>stable<span class="token operator">/</span>jenkins<span class="token punctuation">.</span>repo
<span class="token comment">// 2</span>
sudo rpm <span class="token operator">--</span><span class="token keyword">import</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>pkg<span class="token punctuation">.</span>jenkins<span class="token punctuation">.</span>io<span class="token operator">/</span>redhat<span class="token operator">-</span>stable<span class="token operator">/</span>jenkins<span class="token punctuation">.</span>io<span class="token punctuation">.</span>key
<span class="token comment">// 3</span>
yum install jenkins
<span class="token comment">// 卸载</span>
service jenkins stop
yum clean all
yum <span class="token operator">-</span>y remove jenkins

<span class="token comment">// 启动</span>
systemctl start jenkins
<span class="token comment">// 重启</span>
systemctl restart jenkins
<span class="token comment">// 查看状态</span>
systemctl status jenkins


<span class="token comment">// 密码存放位子</span>
<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>jenkins<span class="token operator">/</span>secrets<span class="token operator">/</span>initialAdminPassword

<span class="token comment">// 修改jenkins 默认端口</span>
vim <span class="token operator">/</span>etc<span class="token operator">/</span>sysconfig<span class="token operator">/</span>jenkins
<span class="token comment">// 找到 JENKINS_PORT=&quot;8080&quot; 这个就是默认的8080  将他修改即可 </span>

</code></pre></div><ul><li>关闭防火墙</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>systemctl stop firewalld<span class="token punctuation">.</span>service
systemctl disable firewalld<span class="token punctuation">.</span>service
</code></pre></div><h2 id="jenkins使用"><a href="#jenkins使用" aria-hidden="true" class="header-anchor">#</a> jenkins使用</h2> <h3 id="角色和用户管理"><a href="#角色和用户管理" aria-hidden="true" class="header-anchor">#</a> 角色和用户管理</h3> <ul><li><p>安装 Role-based Authorization Strategy 插件</p></li> <li><p>首先注册2个账号分别 zhangsan/lisi</p></li> <li><p><code>系统管理-&gt;Manage Roles</code> 配置管理角色
<img src="/img/manageroles.jpg"></p></li> <li><p><code>系统管理-&gt;Assign Roles</code> 配置分配角色
<img src="/img/assignroles.jpg"></p></li> <li><p>新建任务<code>dev-first&amp;&amp;qa-first</code></p></li> <li><p>新建任务 构建过程加上git，配置如下</p></li> <li><p>有几点要注意</p></li> <li><p>1、jenkins 拉去git代码 需要jenkins 获取ssh公钥,配置到git服务器中</p></li> <li><p>2、修改jenkins配置文件 将用户修改成root,<code>vim /etc/sysconfig/jenkins</code>,修改为<code>JENKINS_USER=&quot;root&quot;</code></p></li> <li><p>3、Repository URL 写git的地址</p></li> <li><p>只要服务器有新的分支 jenkins 就能更新到
<img src="/img/jenkinstasks.jpg"> <img src="/img/managecode.jpg"> <img src="/img/parameter.jpg"></p></li></ul> <h2 id="安装-nodejs-环境"><a href="#安装-nodejs-环境" aria-hidden="true" class="header-anchor">#</a> 安装 Nodejs 环境</h2> <ul><li>我们其实并没有在服务端安装 Node 环境。如果想要安装 Node 环境，有以下两个办法：
<ul><li>源码编译：这种方式是将 Node     源码拉下来后，在服务器端编译完成后才可以使用。时间比较长，流程也略复杂</li> <li>使用 Jenkins Plugin 中 NodeJS 插件自动配置安装</li></ul></li> <li>我们打开 Jenkins 首页，找到左侧的系统配置 =&gt; 插件管理 =&gt; 可选插件，搜索 Node 。选中 NodeJS 后，点击左下角的 直接安装 开始安装插件
<img src="/img/jenkins_node.png"></li></ul> <img src="/img/jenkins_node1.png"> <ul><li><p>等待安装完毕后，返回 Jenkins 首页。找到 <code>Global Tool Configuration</code> =&gt; <code>NodeJS</code> =&gt; <code>新增NodeJS</code></p></li> <li><p>接着回到 Jenkins 首页，找到左侧的 <code>系统配置</code> ，选择 <code>全局工具配置</code> <img src="/img/jenkins_node2.png"></p></li> <li><p>找到下面的 NodeJS ，点击 NodeJS 安装，选择相应的版本填写信息保存即可。
<img src="/img/jenkins_node3.png"></p></li></ul> <h2 id="如何使用"><a href="#如何使用" aria-hidden="true" class="header-anchor">#</a> 如何使用</h2> <ul><li>那我们在任务中如何使用呢？我们只需要在任务的配置中，找到构建环境，选中 Provide Node &amp; npm bin/ folder to PATH ，选择刚才配置好的 NodeJS 即可。</li> <li>第一次执行会下载对应的 Node 版本，后续不会下载。
<img src="/img/jenkins_node4.png"></li></ul> <h3 id="使用-ssh-协议集成-git-仓库源"><a href="#使用-ssh-协议集成-git-仓库源" aria-hidden="true" class="header-anchor">#</a> 使用 SSH 协议集成 Git 仓库源</h3> <ul><li>这一步，我们使用 Jenkins 集成外部 Git 仓库，实现对真实代码的拉取和构建。在这里，我们选用 Gitee  作为我们的代码源 。这里准备一个 vue-cli 项目来演示构建。</li></ul> <h3 id="生成公钥私钥"><a href="#生成公钥私钥" aria-hidden="true" class="header-anchor">#</a> 生成公钥私钥</h3> <ul><li>首先，我们先来配置公钥和私钥。这是 Jenkins 访问 Git 私有库的常用认证方式。我们可以使用 ssh-keygen 命令即可生成公钥私钥。在本地机器执行生成即可。这里的邮箱可以换成你自己的邮箱：</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>ssh<span class="token punctuation">-</span>keygen <span class="token punctuation">-</span>t rsa <span class="token punctuation">-</span>C &quot;xxx@qq.com&quot;
</code></pre></div><img src="/img/jenkins_node5.png">
- 一路回车即可。
- 结束后，你会得到两个文件。分别是 xxx 和 xxx.pub。
- 其中，xxx 是私钥文件，xxx.pub 是对应的公钥文件。我们需要在 Git 端配置公钥，在 Jenkins 端使用私钥与 Git 进行身份校验
<h3 id="在-gitee-配置公钥"><a href="#在-gitee-配置公钥" aria-hidden="true" class="header-anchor">#</a> 在 Gitee 配置公钥</h3> <ul><li>在 Gitee 中，如果你要配置公钥有2种方式：仓库公钥 和 个人公钥。其中，如果配置了仓库公钥，则该公钥只能对配置的仓库进行访问。如果配置了个人公钥，则账号下所有私有仓库都可以访问。</li> <li>这里我们就以配置个人公钥为例子。首先打开右上角的设置 ，点击下面的 安全设置 =&gt; SSH公钥</li> <li>在下方有个添加公钥，填入信息即可。</li> <li>其中的标题为公钥标题，这里可以自定义标题；公钥则为刚才生成的 xxx.pub 文件。使用 cat 命令查看下文件内容，将内容填入输入框并保存。接着去 Jenkins  端配置私钥
<img src="/img/jenkins_node6.png"></li></ul> <h3 id="在-jenkins-配置私钥"><a href="#在-jenkins-配置私钥" aria-hidden="true" class="header-anchor">#</a> 在 Jenkins 配置私钥</h3> <ul><li>回到 Jenkins。在 Jenkins 中，私钥/密码 等认证信息都是以 凭证 的方式管理的，所以可以做到全局都通用。</li> <li>我们可以在配置任务时，来添加一个自己的凭证。点击项目的 配置，依次找到 源码管理 =&gt; Git =&gt; Repositories
<img src="/img/jenkins_node7.png"> <img src="/img/jenkins_node8.png"></li> <li>保存后，在 Credentials 下拉列表中选择你添加的凭证。</li> <li>如果没有出现红色无权限提示，则代表身份校验成功，可以正常访问。</li></ul> <img src="/img/jenkins_node9.png"> <h2 id="构建镜像"><a href="#构建镜像" aria-hidden="true" class="header-anchor">#</a> 构建镜像</h2> <h3 id="编写-dockerfile"><a href="#编写-dockerfile" aria-hidden="true" class="header-anchor">#</a> 编写 DockerFile</h3> <ul><li>基于 nginx:1.15 镜像做底座。</li> <li>拷贝本地 html 文件夹内的文件，到镜像内 /etc/nginx/html 文件夹。</li> <li>拷贝本地 conf 文件夹内的文件，到镜像内 /etc/nginx/  文件夹。</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>FROM nginx<span class="token punctuation">:</span>1.15<span class="token punctuation">-</span>alpine
COPY html /etc/nginx/html
COPY conf /etc/nginx/
WORKDIR /etc/nginx/html
</code></pre></div><ul><li>编写完成后，怎么生成镜像呢？我们只需要使用 docker build 命令就可以构建一个镜像了：
<ul><li>-t: 声明要打一个镜像的Tag标签，紧跟着的后面就是标签。标签格式为 镜像名:版本</li></ul></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>docker build <span class="token punctuation">-</span>t imagename<span class="token punctuation">:</span>version .
</code></pre></div><ul><li>因为我们的镜像只包含一个 nginx，所以 dockerfile 内容比较简单。我们只需要在代码根目录下新建一个名为 DockerFile 的文件，输入以下内容，并将其提交到代码库即可。</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code>vi DockerFile
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code>FROM nginx<span class="token punctuation">:</span>1.15<span class="token punctuation">-</span>alpine
COPY html /etc/nginx/html
COPY conf /etc/nginx/
WORKDIR /etc/nginx/html
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code>git add ./DockerFile
git commit <span class="token punctuation">-</span>m &quot;chore<span class="token punctuation">:</span> add dockerfile&quot;
git push
</code></pre></div><h2 id="jenkins-端配置"><a href="#jenkins-端配置" aria-hidden="true" class="header-anchor">#</a> Jenkins 端配置</h2> <ul><li>在代码源和 DockerFile 准备就绪后，我们只需在 Jenkins 端配置下要执行的 Shell 脚本即可。找到项目的配置，依次找到 构建 =&gt; Execute shell。输入以下脚本：</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#!/bin/sh -l</span>

npm install <span class="token punctuation">-</span><span class="token punctuation">-</span>registry=https<span class="token punctuation">:</span>//registry.npm.taobao.org
npm run build
docker build <span class="token punctuation">-</span>t jenkins<span class="token punctuation">-</span>test .
</code></pre></div><ul><li>这里脚本很简单，主要就是 安装依赖 =&gt; 构建文件 =&gt; 构建镜像。填写完毕后保存</li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">8/1/2021, 12:54:22 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/devOps/docker.html" class="prev">
          docker
        </a></span> <span class="next"><a href="/devOps/vscode.html">
          vscode
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.188d2b4b.js" defer></script><script src="/assets/js/47.5b0c84f7.js" defer></script>
  </body>
</html>
